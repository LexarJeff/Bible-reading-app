<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script>
    // OTA apply ‚Äî runs during parsing BEFORE any body content renders.
    // If cached update is newer, writes it and appends <!-- to comment out
    // the entire rest of this page. __ota_applied flag prevents re-entry.
    (function() {
      try {
        if (window.__ota_applied) return;
        var c = localStorage.getItem('ota-html');
        var v = localStorage.getItem('ota-version');
        if (!c || !v) return;
        var cur = "2.0.10";
        var pa = v.split('.').map(Number), pb = cur.split('.').map(Number);
        for (var i = 0; i < 3; i++) {
          if ((pa[i]||0) > (pb[i]||0)) {
            window.__ota_applied = true;
            document.write(c + '<!--');
            return;
          }
          if ((pa[i]||0) < (pb[i]||0)) return;
        }
      } catch(e) {}
    })();
  </script>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1a1612">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <title>Bible Reading 2026</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-180v2.png">
  <meta name="apple-mobile-web-app-title" content="Bible 2026">
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&family=Cinzel:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Crimson Text', Georgia, serif;
      background: linear-gradient(145deg, #1a1612 0%, #2d2520 50%, #1a1612 100%);
      color: #e8e0d5;
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }

    .header { background: linear-gradient(180deg, rgba(139,90,43,0.3) 0%, transparent 100%); padding: 1rem; text-align: center; border-bottom: 1px solid rgba(212,165,116,0.2); }
    .title { font-family: 'Cinzel', serif; font-size: 1.4rem; color: #d4a574; letter-spacing: 0.1em; }

    .progress-section { padding: 0.75rem 1rem; background: rgba(0,0,0,0.2); }
    .progress-bar { background: rgba(0,0,0,0.4); border-radius: 8px; height: 16px; overflow: hidden; position: relative; border: 1px solid rgba(212,165,116,0.2); }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #2d5a27, #50C878); transition: width 0.5s; }
    .progress-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 0.65rem; color: #fff; font-weight: 600; }
    .progress-marker { position: absolute; top: -1px; bottom: -1px; width: 2px; background: #d4a574; z-index: 1; transition: left 0.5s; }
    .progress-marker::after { content: ''; position: absolute; top: -4px; left: -3px; width: 0; height: 0; border-left: 4px solid transparent; border-right: 4px solid transparent; border-top: 4px solid #d4a574; }

    .stats-row { display: flex; justify-content: space-around; margin-top: 0.6rem; text-align: center; }
    .stat-value { font-family: 'Cinzel', serif; font-size: 1.1rem; font-weight: 600; color: #50C878; }
    .stat-value.behind { color: #e74c3c; }
    .stat-label { font-size: 0.6rem; color: #a89880; text-transform: uppercase; }


    .section-title { font-family: 'Cinzel', serif; font-size: 0.8rem; color: #d4a574; padding: 0.75rem 1rem 0.4rem; text-transform: uppercase; letter-spacing: 0.1em; }

    .bible-grid { display: flex; flex-wrap: wrap; gap: 5px; padding: 0.4rem 1rem 0.75rem; }
    .book-box { width: 38px; height: 38px; border-radius: 5px; border: 2px solid rgba(80,200,120,0.3); background: transparent; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.5rem; font-weight: 600; color: #a89880; text-align: center; line-height: 1.1; padding: 2px; transition: all 0.2s; }
    .book-box:active { transform: scale(0.95); }
    .book-box.complete { background: #50C878; border-color: #50C878; color: #1a1612; }
    .book-box.in-progress { border-color: #d4a574; color: #d4a574; }
    .book-box.expanded { border-color: #DAA520; box-shadow: 0 0 8px rgba(218,165,32,0.4); }

    .expanded-book { background: rgba(45,37,32,0.8); margin: 0.4rem 1rem 0.75rem; border-radius: 10px; border: 1px solid rgba(212,165,116,0.3); overflow: hidden; display: none; }
    .expanded-book.show { display: block; }
    .expanded-header { display: flex; align-items: center; justify-content: space-between; padding: 0.6rem 0.75rem; background: rgba(212,165,116,0.1); cursor: pointer; }
    .expanded-title { font-family: 'Cinzel', serif; font-size: 0.95rem; color: #d4a574; }
    .expanded-close { color: #a89880; font-size: 1.1rem; }
    .expanded-readings { display: flex; flex-wrap: wrap; gap: 5px; padding: 0.6rem; }
    .reading-box { width: 48px; height: 48px; border-radius: 5px; border: 2px solid rgba(80,200,120,0.4); background: transparent; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; font-size: 0.55rem; color: #a89880; padding: 3px; transition: all 0.2s; }
    .reading-box:active { transform: scale(0.95); }
    .reading-box.complete { background: #50C878; border-color: #50C878; color: #1a1612; }
    .reading-box .date { font-weight: 600; font-size: 0.6rem; }
    .reading-box .chapters { font-size: 0.45rem; opacity: 0.8; margin-top: 1px; }

    .readings-section { padding: 0 1rem 5rem; }
    .reading-item { display: flex; align-items: center; padding: 0.75rem 0.65rem; margin: 0.35rem 0; background: rgba(35,28,24,0.7); border-radius: 8px; border-left: 3px solid #d4a574; cursor: pointer; transition: all 0.2s; }
    .reading-item:active { transform: scale(0.98); }
    .reading-item.current { background: rgba(212,165,116,0.15); border-left-color: #DAA520; box-shadow: 0 0 10px rgba(212,165,116,0.2); }
    .reading-item.alt { background: rgba(60,50,42,0.75); border-left-color: #c49564; }

    .checkbox { width: 20px; height: 20px; border: 2px solid rgba(80,200,120,0.5); border-radius: 50%; margin-right: 0.6rem; flex-shrink: 0; }
    .reading-content { flex: 1; min-width: 0; }
    .reading-header { display: flex; align-items: center; gap: 0.35rem; flex-wrap: wrap; }
    .reading-date { font-size: 0.65rem; color: #a89880; background: rgba(0,0,0,0.3); padding: 0.1rem 0.3rem; border-radius: 3px; }
    .indicator { font-size: 0.65rem; }
    .indicator.diamond { color: #e74c3c; }
    .indicator.dot { color: #3498db; }
    .current-badge { font-size: 0.5rem; background: linear-gradient(135deg, #d4a574, #DAA520); color: #1a1612; padding: 0.1rem 0.3rem; border-radius: 3px; font-weight: 600; text-transform: uppercase; }
    .reading-title { font-size: 0.9rem; font-weight: 600; color: #e8e0d5; margin-top: 0.1rem; }

    .read-now-btn { background: linear-gradient(135deg, #2d5a27, #50C878); border: none; color: #fff; padding: 0.45rem 0.75rem; border-radius: 5px; font-size: 0.7rem; font-weight: 600; cursor: pointer; margin-left: auto; flex-shrink: 0; }
    .read-now-btn:active { transform: scale(0.95); }

    .reading-segments { display: flex; flex-direction: column; gap: 5px; margin-top: 0.5rem; width: 100%; }
    .segment-row { display: flex; align-items: center; gap: 10px; }
    .segment-label { font-size: 0.85rem; color: #e8e0d5; flex: 1; min-width: 0; line-height: 1.3; font-style: italic; }

    .bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(26,22,18,0.95); border-top: 1px solid rgba(212,165,116,0.2); padding: 0.5rem; padding-bottom: calc(0.5rem + env(safe-area-inset-bottom)); display: flex; justify-content: space-around; backdrop-filter: blur(10px); }
    .bottom-btn { display: flex; flex-direction: column; align-items: center; gap: 0.1rem; background: none; border: none; color: #a89880; font-family: 'Crimson Text', serif; font-size: 0.55rem; cursor: pointer; padding: 0.25rem; }
    .bottom-btn svg { width: 18px; height: 18px; }
    .bottom-btn:active { color: #d4a574; }

    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 100; padding: 1rem; }
    .modal-overlay.show { display: flex; }
    .modal { background: #2d2520; border-radius: 14px; padding: 1.25rem; max-width: 380px; width: 100%; border: 1px solid rgba(212,165,116,0.3); max-height: 80vh; overflow-y: auto; }
    .modal h3 { font-family: 'Cinzel', serif; color: #d4a574; margin: 0 0 0.75rem; font-size: 1.1rem; }
    .modal p { color: #a89880; margin-bottom: 0.75rem; font-size: 0.85rem; }
    .modal-btn { width: 100%; padding: 0.85rem; margin: 0.4rem 0; border: 1px solid rgba(212,165,116,0.3); background: rgba(212,165,116,0.1); color: #e8e0d5; border-radius: 8px; font-family: 'Crimson Text', serif; font-size: 0.95rem; cursor: pointer; }
    .modal-btn:active { background: rgba(212,165,116,0.2); }
    .modal-close { background: transparent; border: none; color: #a89880; padding: 0.4rem 0.8rem; cursor: pointer; font-family: 'Crimson Text', serif; margin-top: 0.4rem; font-size: 0.9rem; width: 100%; }


    .more-text { text-align: center; color: #a89880; font-size: 0.8rem; padding: 0.75rem; }


    .settings-divider { border: none; border-top: 1px solid rgba(212,165,116,0.2); margin: 0.75rem 0; }
    .settings-version { text-align: center; color: #a89880; font-size: 0.75rem; margin-top: 0.5rem; }

    input[type="file"] { display: none; }

    .backup-reminder { background: rgba(212,165,116,0.12); border: 1px solid rgba(212,165,116,0.25); border-radius: 8px; margin: 0.5rem 1rem 0; padding: 0.5rem 0.75rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.75rem; color: #d4a574; }
    .backup-reminder-text { flex: 1; }
    .backup-reminder-btn { background: rgba(212,165,116,0.2); border: 1px solid rgba(212,165,116,0.4); color: #d4a574; padding: 0.3rem 0.6rem; border-radius: 5px; font-family: 'Crimson Text', serif; font-size: 0.7rem; cursor: pointer; white-space: nowrap; }
    .backup-reminder-btn:active { background: rgba(212,165,116,0.35); }
    .backup-reminder-dismiss { background: none; border: none; color: #a89880; font-size: 1rem; cursor: pointer; padding: 0 0.25rem; line-height: 1; }

    .plan-subtitle { font-size: 0.7rem; color: #a89880; margin-top: 0.15rem; }

    .plan-picker-grid { display: flex; flex-direction: column; gap: 0.5rem; }
    .plan-option { padding: 0.85rem; border: 1px solid rgba(212,165,116,0.3); background: rgba(212,165,116,0.1); border-radius: 8px; cursor: pointer; text-align: left; font-family: 'Crimson Text', serif; color: #e8e0d5; }
    .plan-option:active { background: rgba(212,165,116,0.25); }
    .plan-option .plan-name { font-family: 'Cinzel', serif; font-size: 0.95rem; color: #d4a574; }
    .plan-option .plan-desc { font-size: 0.75rem; color: #a89880; margin-top: 0.2rem; }

    .modal-btn.danger { background: rgba(231,76,60,0.15); border-color: rgba(231,76,60,0.4); color: #e74c3c; }
    .modal-btn.danger:active { background: rgba(231,76,60,0.3); }


    .chapter-card { width: 60px; height: 62px; border-radius: 8px; border: 2px solid rgba(80,200,120,0.3); background: rgba(45,37,32,0.6); display: flex; flex-direction: column; align-items: center; cursor: pointer; position: relative; transition: all 0.2s; overflow: hidden; }
    .chapter-card:active { transform: scale(0.95); }
    .chapter-card .ch-num { font-size: 0.9rem; font-weight: 600; color: #e8e0d5; line-height: 1; flex: 1; display: flex; align-items: center; justify-content: center; width: 100%; }
    .chapter-card .ch-open { background: rgba(212,165,116,0.25); text-align: center; font-size: 0.55rem; color: #d4a574; padding: 5px 0; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; width: 100%; }
    .chapter-card .ch-open:active { background: rgba(212,165,116,0.5); }
    .chapter-card.complete { background: #50C878; border-color: #50C878; }
    .chapter-card.complete .ch-num { color: #1a1612; }
    .chapter-card.complete .ch-open { background: rgba(0,0,0,0.15); color: #1a1612; }
    .chapter-card.complete::before { content: '‚úì'; position: absolute; top: 2px; right: 4px; font-size: 0.55rem; color: #1a1612; font-weight: 700; }

    .spin-btn { background: linear-gradient(135deg, #d4a574, #DAA520); border: none; color: #1a1612; padding: 0.75rem 1.5rem; border-radius: 10px; font-family: 'Cinzel', serif; font-size: 1rem; font-weight: 600; cursor: pointer; margin: 0.75rem 1rem; display: block; width: calc(100% - 2rem); text-align: center; letter-spacing: 0.05em; }
    .spin-btn:active { transform: scale(0.97); opacity: 0.9; }
    .spin-btn:disabled { opacity: 0.5; cursor: default; }

    .book-box.spin-highlight { border-color: #DAA520; background: rgba(218,165,32,0.4); color: #DAA520; box-shadow: 0 0 12px rgba(218,165,32,0.6); }
    .book-box.spin-selected { border-color: #50C878; background: rgba(80,200,120,0.3); color: #50C878; box-shadow: 0 0 16px rgba(80,200,120,0.6); animation: pulse-glow 0.6s ease-in-out 3; }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 16px rgba(80,200,120,0.6); }
      50% { box-shadow: 0 0 24px rgba(80,200,120,0.9); }
    }

    .dealer-result { text-align: center; padding: 0.5rem 0; }
    .dealer-result-book { font-family: 'Cinzel', serif; font-size: 1.3rem; color: #d4a574; margin-bottom: 0.25rem; }
    .dealer-result-chapter { font-size: 1.1rem; color: #e8e0d5; margin-bottom: 1rem; }
    .dealer-actions { display: flex; gap: 0.5rem; }
    .dealer-actions .modal-btn { flex: 1; }
    .dealer-actions .modal-btn.primary { background: linear-gradient(135deg, #2d5a27, #50C878); border-color: #50C878; color: #fff; }
    .dealer-actions .modal-btn.complete-btn { background: rgba(80,200,120,0.15); border-color: rgba(80,200,120,0.4); color: #50C878; }
    .dealer-actions .modal-btn.complete-btn.done { background: #50C878; border-color: #50C878; color: #1a1612; }
  </style>
</head>
<body>
  <header class="header">
    <h1 class="title">Bible Reading 2026</h1>
    <div class="plan-subtitle" id="planSubtitle"></div>
  </header>

  <section class="progress-section">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
      <div class="progress-marker" id="progressMarker"></div>
      <span class="progress-text" id="progressText">0%</span>
    </div>
    <div class="stats-row">
      <div><div class="stat-value" id="statDone">0</div><div class="stat-label">Done</div></div>
      <div><div class="stat-value" id="statToGo">365</div><div class="stat-label">To Go</div></div>
      <div><div class="stat-value" id="statBehind">0</div><div class="stat-label" id="statBehindLabel">Behind</div></div>
    </div>
  </section>

  <div class="backup-reminder" id="backupReminder" style="display:none;">
    <span class="backup-reminder-text" id="backupReminderText"></span>
    <button class="backup-reminder-btn" onclick="exportData()">Export Now</button>
    <button class="backup-reminder-dismiss" onclick="dismissBackupReminder()">‚úï</button>
  </div>

  <div class="section-title">Books of the Bible</div>
  <div class="bible-grid" id="bibleGrid"></div>

  <div class="expanded-book" id="expandedBook">
    <div class="expanded-header" onclick="closeExpandedBook()">
      <span class="expanded-title" id="expandedTitle"></span>
      <span class="expanded-close">‚úï</span>
    </div>
    <div class="expanded-readings" id="expandedReadings"></div>
  </div>

  <div class="section-title" id="upNextTitle">Up Next</div>
  <div class="readings-section" id="readingsSection"></div>

  <nav class="bottom-bar">
    <button class="bottom-btn" onclick="showSettings()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      Settings
    </button>
  </nav>

  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <h3>Settings</h3>
      <p>Reading Plan</p>
      <button class="modal-btn" onclick="showPlanPicker()" id="changePlanBtn">Change Reading Plan</button>
      <button class="modal-btn" id="changeStartDateBtn" onclick="showChangeStartDate()" style="display:none;">Change Start Date</button>
      <div id="currentStartDateDisplay" style="text-align:center;color:#a89880;font-size:0.75rem;margin-top:0.25rem;display:none;"></div>
      <hr class="settings-divider">
      <p>Backup & Restore</p>
      <button class="modal-btn" onclick="exportData()">üì§ Export Progress</button>
      <button class="modal-btn" onclick="importBackup()">üì• Import Backup</button>
      <input type="file" id="importFileInput" accept=".json" onchange="importData(event)" style="display:none;">
      <hr class="settings-divider">
      <button class="modal-btn danger" onclick="confirmStartOver()">Start Over</button>
      <hr class="settings-divider">
      <button class="modal-btn" onclick="checkForUpdateManual()" id="checkUpdateBtn">üîÑ Check for Update</button>
      <div class="settings-version" id="settingsVersion"></div>
      <button class="modal-close" onclick="hideSettings()">Close</button>
    </div>
  </div>

  <div class="modal-overlay" id="stylePickerModal">
    <div class="modal">
      <h3>How Would You Like to Read?</h3>
      <p>Choose your reading style.</p>
      <div class="plan-picker-grid">
        <div class="plan-option" onclick="selectStyle('bible')">
          <div class="plan-name">Bible Order</div>
          <div class="plan-desc">Genesis to Revelation ‚Äî the traditional book order</div>
        </div>
        <div class="plan-option" onclick="selectStyle('chrono')">
          <div class="plan-name">Chronological</div>
          <div class="plan-desc">Read in the order events happened historically</div>
        </div>
      </div>
      <button class="modal-close" id="stylePickerClose" onclick="hideStylePicker()">Cancel</button>
    </div>
  </div>

  <div class="modal-overlay" id="pacePickerModal">
    <div class="modal">
      <h3>Choose Your Pace</h3>
      <p>Select how quickly you'd like to read.</p>
      <div class="plan-picker-grid" id="pacePickerOptions">
        <div class="plan-option" onclick="selectPace('1year')">
          <div class="plan-name">1 Year</div>
          <div class="plan-desc">Read the entire Bible in one year (~3-4 chapters/day)</div>
        </div>
        <div class="plan-option pace-bible-only" onclick="selectPace('2year')">
          <div class="plan-name">2 Year</div>
          <div class="plan-desc">A slower pace through the Bible (~1-2 chapters/day)</div>
        </div>
        <div class="plan-option pace-bible-only" onclick="selectPace('3year')">
          <div class="plan-name">3 Year</div>
          <div class="plan-desc">A relaxed pace (~1 chapter/day)</div>
        </div>
        <div class="plan-option" onclick="selectPace('freestyle')">
          <div class="plan-name">Freestyle</div>
          <div class="plan-desc">No schedule ‚Äî check off chapters at your own pace</div>
        </div>
      </div>
      <button class="modal-close" onclick="backToStylePicker()">Back</button>
    </div>
  </div>

  <div class="modal-overlay" id="dealerResultModal">
    <div class="modal">
      <h3>Random Pick</h3>
      <div class="dealer-result">
        <div class="dealer-result-book" id="dealerBook"></div>
        <div class="dealer-result-chapter" id="dealerChapter"></div>
      </div>
      <div class="dealer-actions">
        <button class="modal-btn primary" id="dealerReadBtn" onclick="dealerRead()">Read Now</button>
        <button class="modal-btn complete-btn" id="dealerCompleteBtn" onclick="dealerComplete()">Mark Complete</button>
      </div>
      <button class="modal-close" onclick="hideDealerResult()">Close</button>
    </div>
  </div>

  <div class="modal-overlay" id="startDateModal">
    <div class="modal">
      <h3>When would you like to start?</h3>
      <p>Pick the date your reading plan begins. Your "behind" count will be based on this date.</p>
      <input type="date" id="startDateInput" style="width:100%;padding:0.75rem;border-radius:8px;border:1px solid rgba(212,165,116,0.3);background:rgba(0,0,0,0.3);color:#e8e0d5;font-family:'Crimson Text',serif;font-size:1rem;margin:0.5rem 0;">
      <button class="modal-btn" onclick="confirmStartDate()" style="background:linear-gradient(135deg,#2d5a27,#50C878);border-color:#50C878;color:#fff;">Start</button>
      <button class="modal-close" onclick="cancelStartDate()">Cancel</button>
    </div>
  </div>

  <script>
    // App version ‚Äî bump this when publishing a new release
    // IMPORTANT: Also update the "cur" variable in the OTA apply block in <head>
    const APP_VERSION = "2.0.10";

    // Version comparison
    function compareVersions(a, b) {
      var pa = a.split('.').map(Number);
      var pb = b.split('.').map(Number);
      for (var i = 0; i < 3; i++) {
        var na = pa[i] || 0;
        var nb = pb[i] || 0;
        if (na > nb) return 1;
        if (na < nb) return -1;
      }
      return 0;
    }

    // Capacitor helper ‚Äî uses native bridge when available, falls back to web APIs
    function isNative() {
      return window.Capacitor && window.Capacitor.isNativePlatform && window.Capacitor.isNativePlatform();
    }

    // Configure status bar on native
    document.addEventListener('DOMContentLoaded', function() {
      if (isNative()) {
        var StatusBar = window.Capacitor.Plugins.StatusBar;
        if (StatusBar) {
          StatusBar.setBackgroundColor({ color: '#1a1612' }).catch(function() {});
          StatusBar.setStyle({ style: 'DARK' }).catch(function() {});
        }
      }
    });

    // OTA update ‚Äî manual check from Settings
    window.checkForUpdateManual = function() {
      var btn = document.getElementById('checkUpdateBtn');
      btn.textContent = '‚è≥ Checking...';
      btn.disabled = true;
      fetch('https://raw.githubusercontent.com/LexarJeff/Bible-reading-app/main/www/index.html')
        .then(function(r) { return r.text(); })
        .then(function(html) {
          var match = html.match(/const APP_VERSION\s*=\s*"([^"]+)"/);
          if (!match) {
            btn.textContent = '‚ùå Check failed';
            setTimeout(function() { btn.textContent = 'üîÑ Check for Update'; btn.disabled = false; }, 2000);
            return;
          }
          var remoteVersion = match[1];
          if (compareVersions(remoteVersion, APP_VERSION) > 0) {
            localStorage.setItem('ota-html', html);
            localStorage.setItem('ota-version', remoteVersion);
            btn.textContent = '‚¨áÔ∏è Install v' + remoteVersion;
            btn.disabled = false;
            btn.onclick = function() { applyUpdate(); };
          } else {
            btn.textContent = '‚úÖ Up to date';
            setTimeout(function() { btn.textContent = 'üîÑ Check for Update'; btn.disabled = false; }, 2000);
          }
        })
        .catch(function() {
          btn.textContent = '‚ùå No connection';
          setTimeout(function() { btn.textContent = 'üîÑ Check for Update'; btn.disabled = false; }, 2000);
        });
    };

    function applyUpdate() {
      // Reload the page ‚Äî the OTA apply block at the top of the script
      // will detect the cached update and replace the page during parsing.
      window.location.reload();
    }

    // Helper to open external URLs
    function openExternal(url) {
      if (isNative()) {
        var Browser = window.Capacitor.Plugins.Browser;
        if (Browser) {
          Browser.open({ url: url });
          return;
        }
      }
      window.open(url, '_blank');
    }

    // Data
    const STORAGE_KEY = 'bible-reading-tracker-2026';
    const DEFAULT_START_DATE = '2026-01-01';

    function getStartDateKey() {
      return 'bible-reading-start-date-' + currentPlan + '-' + currentOrder;
    }

    function getStartDate() {
      if (!currentPlan || currentPlan === 'freestyle') return new Date(2026, 0, 1);
      var stored = localStorage.getItem(getStartDateKey());
      // Fallback to old key format (without order suffix)
      if (!stored) stored = localStorage.getItem('bible-reading-start-date-' + currentPlan);
      if (stored) {
        var parts = stored.split('-');
        return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
      }
      return new Date(2026, 0, 1);
    }

    function setStartDate(dateStr) {
      if (!currentPlan) return;
      localStorage.setItem(getStartDateKey(), dateStr);
    }

    function getStartDateStr() {
      if (!currentPlan || currentPlan === 'freestyle') return DEFAULT_START_DATE;
      var stored = localStorage.getItem(getStartDateKey());
      if (!stored) stored = localStorage.getItem('bible-reading-start-date-' + currentPlan);
      return stored || DEFAULT_START_DATE;
    }

    const BOOK_ABBREV = {
      "Genesis": "Ge", "Exodus": "Ex", "Leviticus": "Le", "Numbers": "Nu",
      "Deuteronomy": "De", "Joshua": "Jos", "Judges": "Jg", "Ruth": "Ru",
      "1 Samuel": "1Sa", "2 Samuel": "2Sa", "1 Kings": "1Ki", "2 Kings": "2Ki",
      "1 Chronicles": "1Ch", "2 Chronicles": "2Ch", "Ezra": "Ezr", "Nehemiah": "Ne",
      "Esther": "Es", "Job": "Job", "Psalms": "Ps", "Proverbs": "Pr",
      "Ecclesiastes": "Ec", "Song of Solomon": "Ca", "Isaiah": "Isa", "Jeremiah": "Jer",
      "Lamentations": "La", "Ezekiel": "Eze", "Daniel": "Da", "Hosea": "Ho",
      "Joel": "Joe", "Amos": "Am", "Obadiah": "Ob", "Jonah": "Jon",
      "Obadiah/Jonah": "Ob/Jon", "Micah": "Mic",
      "Nahum": "Na", "Habakkuk": "Hab", "Nahum/Habakkuk": "Na/Hab",
      "Zephaniah": "Zep", "Haggai": "Hag", "Zephaniah/Haggai": "Zep/Hag", "Zechariah": "Zec",
      "Malachi": "Mal", "Matthew": "Mt", "Mark": "Mr", "Luke": "Lu", "John": "Joh",
      "Acts": "Ac", "Romans": "Ro", "1 Corinthians": "1Co", "2 Corinthians": "2Co",
      "Galatians": "Ga", "Ephesians": "Eph", "Philippians": "Php", "Colossians": "Col",
      "1 Thessalonians": "1Th", "2 Thessalonians": "2Th", "1 Timothy": "1Ti",
      "2 Timothy": "2Ti", "Titus": "Tit", "Philemon": "Phm",
      "Titus/Philemon": "Tit/Phm", "Hebrews": "Heb", "James": "Jas",
      "1 Peter": "1Pe", "2 Peter": "2Pe", "1 John": "1Jo",
      "2 John": "2Jo", "3 John": "3Jo", "Jude": "Jude",
      "2 John/3 John/Jude": "2Jo/3Jo/Jude", "Revelation": "Re",
    };

    const BOOK_NUM = {
      "Genesis": 1, "Exodus": 2, "Leviticus": 3, "Numbers": 4, "Deuteronomy": 5,
      "Joshua": 6, "Judges": 7, "Ruth": 8, "1 Samuel": 9, "2 Samuel": 10,
      "1 Kings": 11, "2 Kings": 12, "1 Chronicles": 13, "2 Chronicles": 14,
      "Ezra": 15, "Nehemiah": 16, "Esther": 17, "Job": 18, "Psalms": 19,
      "Proverbs": 20, "Ecclesiastes": 21, "Song of Solomon": 22, "Isaiah": 23,
      "Jeremiah": 24, "Lamentations": 25, "Ezekiel": 26, "Daniel": 27, "Hosea": 28,
      "Joel": 29, "Amos": 30, "Obadiah": 31, "Jonah": 32, "Micah": 33, "Nahum": 34,
      "Habakkuk": 35, "Zephaniah": 36, "Haggai": 37, "Zechariah": 38, "Malachi": 39,
      "Matthew": 40, "Mark": 41, "Luke": 42, "John": 43, "Acts": 44, "Romans": 45,
      "1 Corinthians": 46, "2 Corinthians": 47, "Galatians": 48, "Ephesians": 49,
      "Philippians": 50, "Colossians": 51, "1 Thessalonians": 52, "2 Thessalonians": 53,
      "1 Timothy": 54, "2 Timothy": 55, "Titus": 56, "Philemon": 57, "Hebrews": 58,
      "James": 59, "1 Peter": 60, "2 Peter": 61, "1 John": 62, "2 John": 63,
      "3 John": 64, "Jude": 65, "Revelation": 66,
      "Obadiah/Jonah": 31, "Nahum/Habakkuk": 34, "Zephaniah/Haggai": 36,
      "Titus/Philemon": 56, "2 John/3 John/Jude": 63,
    };

    const BIBLE_BOOKS = [
      ["Genesis",50],["Exodus",40],["Leviticus",27],["Numbers",36],["Deuteronomy",34],
      ["Joshua",24],["Judges",21],["Ruth",4],["1 Samuel",31],["2 Samuel",24],
      ["1 Kings",22],["2 Kings",25],["1 Chronicles",29],["2 Chronicles",36],
      ["Ezra",10],["Nehemiah",13],["Esther",10],["Job",42],["Psalms",150],
      ["Proverbs",31],["Ecclesiastes",12],["Song of Solomon",8],["Isaiah",66],
      ["Jeremiah",52],["Lamentations",5],["Ezekiel",48],["Daniel",12],["Hosea",14],
      ["Joel",3],["Amos",9],["Obadiah",1],["Jonah",4],["Micah",7],["Nahum",3],
      ["Habakkuk",3],["Zephaniah",3],["Haggai",2],["Zechariah",14],["Malachi",4],
      ["Matthew",28],["Mark",16],["Luke",24],["John",21],["Acts",28],["Romans",16],
      ["1 Corinthians",16],["2 Corinthians",13],["Galatians",6],["Ephesians",6],
      ["Philippians",4],["Colossians",4],["1 Thessalonians",5],["2 Thessalonians",3],
      ["1 Timothy",6],["2 Timothy",4],["Titus",3],["Philemon",1],["Hebrews",13],
      ["James",5],["1 Peter",5],["2 Peter",3],["1 John",5],["2 John",1],
      ["3 John",1],["Jude",1],["Revelation",22]
    ];
    const TOTAL_CHAPTERS = 1189;

    const PLAN_TYPES = {
      '1year': { label: '1 Year Plan', days: 364 },
      '2year': { label: '2 Year Plan', days: 730 },
      '3year': { label: '3 Year Plan', days: 1095 },
      'freestyle': { label: 'Freestyle', days: 0 }
    };

    const ORDER_LABELS = { 'bible': 'Bible Order', 'chrono': 'Chronological' };

    function getPlanDays(plan, order) {
      if (plan === 'freestyle') return 0;
      if (order === 'chrono') return 365;
      return PLAN_TYPES[plan] ? PLAN_TYPES[plan].days : 364;
    }

    function generatePlan(totalDays) {
      var chapters = [];
      for (var i = 0; i < BIBLE_BOOKS.length; i++) {
        var bookName = BIBLE_BOOKS[i][0];
        var count = BIBLE_BOOKS[i][1];
        for (var c = 1; c <= count; c++) {
          chapters.push({ book: bookName, chapter: c });
        }
      }
      var perDay = chapters.length / totalDays;
      var readings = [];
      var idx = 0;
      for (var day = 1; day <= totalDays; day++) {
        var endIdx = Math.round(day * perDay);
        if (endIdx > chapters.length) endIdx = chapters.length;
        if (idx >= chapters.length) break;
        // Group contiguous chapters by book
        var dayChapters = chapters.slice(idx, endIdx);
        if (dayChapters.length === 0 && idx < chapters.length) {
          dayChapters = [chapters[idx]];
          endIdx = idx + 1;
        }
        // Split by book
        var groups = [];
        var currentGroup = null;
        for (var j = 0; j < dayChapters.length; j++) {
          var ch = dayChapters[j];
          if (!currentGroup || currentGroup.book !== ch.book) {
            currentGroup = { book: ch.book, start: ch.chapter, end: ch.chapter };
            groups.push(currentGroup);
          } else {
            currentGroup.end = ch.chapter;
          }
        }
        for (var g = 0; g < groups.length; g++) {
          var gr = groups[g];
          var chapStr = gr.start === gr.end ? String(gr.start) : gr.start + '-' + gr.end;
          readings.push({ day: day, book: gr.book, chapters: chapStr, diamond: false, dot: false });
        }
        idx = endIdx;
      }
      return readings;
    }

    const READINGS_1YEAR = [
      { day: 1, book: "Genesis", chapters: "1-3", diamond: false, dot: false },
      { day: 2, book: "Genesis", chapters: "4-7", diamond: false, dot: false },
      { day: 3, book: "Genesis", chapters: "8-11", diamond: false, dot: false },
      { day: 4, book: "Genesis", chapters: "12-15", diamond: true, dot: false },
      { day: 5, book: "Genesis", chapters: "16-18", diamond: true, dot: false },
      { day: 6, book: "Genesis", chapters: "19-22", diamond: true, dot: false },
      { day: 7, book: "Genesis", chapters: "23-24", diamond: true, dot: false },
      { day: 8, book: "Genesis", chapters: "25-27", diamond: true, dot: false },
      { day: 9, book: "Genesis", chapters: "28-30", diamond: true, dot: false },
      { day: 10, book: "Genesis", chapters: "31-32", diamond: true, dot: false },
      { day: 11, book: "Genesis", chapters: "33-34", diamond: true, dot: false },
      { day: 12, book: "Genesis", chapters: "35-37", diamond: true, dot: false },
      { day: 13, book: "Genesis", chapters: "38-40", diamond: true, dot: false },
      { day: 14, book: "Genesis", chapters: "41-42", diamond: true, dot: false },
      { day: 15, book: "Genesis", chapters: "43-45", diamond: true, dot: false },
      { day: 16, book: "Genesis", chapters: "46-48", diamond: true, dot: false },
      { day: 17, book: "Genesis", chapters: "49-50", diamond: true, dot: false },
      { day: 18, book: "Exodus", chapters: "1-4", diamond: true, dot: false },
      { day: 19, book: "Exodus", chapters: "5-7", diamond: true, dot: false },
      { day: 20, book: "Exodus", chapters: "8-10", diamond: true, dot: false },
      { day: 21, book: "Exodus", chapters: "11-13", diamond: true, dot: false },
      { day: 22, book: "Exodus", chapters: "14-15", diamond: true, dot: false },
      { day: 23, book: "Exodus", chapters: "16-18", diamond: true, dot: false },
      { day: 24, book: "Exodus", chapters: "19-21", diamond: true, dot: false },
      { day: 25, book: "Exodus", chapters: "22-25", diamond: false, dot: false },
      { day: 26, book: "Exodus", chapters: "26-28", diamond: false, dot: false },
      { day: 27, book: "Exodus", chapters: "29-30", diamond: false, dot: false },
      { day: 28, book: "Exodus", chapters: "31-33", diamond: true, dot: false },
      { day: 29, book: "Exodus", chapters: "34-35", diamond: true, dot: false },
      { day: 30, book: "Exodus", chapters: "36-38", diamond: false, dot: false },
      { day: 31, book: "Exodus", chapters: "39-40", diamond: false, dot: false },
      { day: 32, book: "Leviticus", chapters: "1-4", diamond: false, dot: false },
      { day: 33, book: "Leviticus", chapters: "5-7", diamond: false, dot: false },
      { day: 34, book: "Leviticus", chapters: "8-10", diamond: false, dot: false },
      { day: 35, book: "Leviticus", chapters: "11-13", diamond: false, dot: false },
      { day: 36, book: "Leviticus", chapters: "14-15", diamond: false, dot: false },
      { day: 37, book: "Leviticus", chapters: "16-18", diamond: false, dot: false },
      { day: 38, book: "Leviticus", chapters: "19-21", diamond: false, dot: false },
      { day: 39, book: "Leviticus", chapters: "22-23", diamond: false, dot: false },
      { day: 40, book: "Leviticus", chapters: "24-25", diamond: false, dot: false },
      { day: 41, book: "Leviticus", chapters: "26-27", diamond: false, dot: false },
      { day: 42, book: "Numbers", chapters: "1-3", diamond: false, dot: false },
      { day: 43, book: "Numbers", chapters: "4-6", diamond: false, dot: false },
      { day: 44, book: "Numbers", chapters: "7-9", diamond: false, dot: false },
      { day: 45, book: "Numbers", chapters: "10-12", diamond: true, dot: false },
      { day: 46, book: "Numbers", chapters: "13-15", diamond: true, dot: false },
      { day: 47, book: "Numbers", chapters: "16-18", diamond: true, dot: false },
      { day: 48, book: "Numbers", chapters: "19-21", diamond: true, dot: false },
      { day: 49, book: "Numbers", chapters: "22-24", diamond: true, dot: false },
      { day: 50, book: "Numbers", chapters: "25-27", diamond: true, dot: false },
      { day: 51, book: "Numbers", chapters: "28-30", diamond: false, dot: false },
      { day: 52, book: "Numbers", chapters: "31-32", diamond: true, dot: false },
      { day: 53, book: "Numbers", chapters: "33-36", diamond: true, dot: false },
      { day: 54, book: "Deuteronomy", chapters: "1-2", diamond: false, dot: false },
      { day: 55, book: "Deuteronomy", chapters: "3-4", diamond: true, dot: false },
      { day: 56, book: "Deuteronomy", chapters: "5-7", diamond: false, dot: false },
      { day: 57, book: "Deuteronomy", chapters: "8-10", diamond: false, dot: false },
      { day: 58, book: "Deuteronomy", chapters: "11-13", diamond: false, dot: false },
      { day: 59, book: "Deuteronomy", chapters: "14-16", diamond: false, dot: false },
      { day: 60, book: "Deuteronomy", chapters: "17-19", diamond: true, dot: false },
      { day: 61, book: "Deuteronomy", chapters: "20-22", diamond: false, dot: false },
      { day: 62, book: "Deuteronomy", chapters: "23-26", diamond: false, dot: false },
      { day: 63, book: "Deuteronomy", chapters: "27-28", diamond: false, dot: false },
      { day: 64, book: "Deuteronomy", chapters: "29-31", diamond: true, dot: false },
      { day: 65, book: "Deuteronomy", chapters: "32", diamond: true, dot: false },
      { day: 66, book: "Deuteronomy", chapters: "33-34", diamond: true, dot: false },
      { day: 67, book: "Joshua", chapters: "1-4", diamond: true, dot: false },
      { day: 68, book: "Joshua", chapters: "5-7", diamond: true, dot: false },
      { day: 69, book: "Joshua", chapters: "8-9", diamond: true, dot: false },
      { day: 70, book: "Joshua", chapters: "10-12", diamond: true, dot: false },
      { day: 71, book: "Joshua", chapters: "13-15", diamond: true, dot: false },
      { day: 72, book: "Joshua", chapters: "16-18", diamond: true, dot: false },
      { day: 73, book: "Joshua", chapters: "19-21", diamond: true, dot: false },
      { day: 74, book: "Joshua", chapters: "22-24", diamond: true, dot: false },
      { day: 75, book: "Judges", chapters: "1-2", diamond: true, dot: false },
      { day: 76, book: "Judges", chapters: "3-5", diamond: true, dot: false },
      { day: 77, book: "Judges", chapters: "6-7", diamond: true, dot: false },
      { day: 78, book: "Judges", chapters: "8-9", diamond: true, dot: false },
      { day: 79, book: "Judges", chapters: "10-11", diamond: true, dot: false },
      { day: 80, book: "Judges", chapters: "12-13", diamond: true, dot: false },
      { day: 81, book: "Judges", chapters: "14-16", diamond: true, dot: false },
      { day: 82, book: "Judges", chapters: "17-19", diamond: true, dot: false },
      { day: 83, book: "Judges", chapters: "20-21", diamond: true, dot: false },
      { day: 84, book: "Ruth", chapters: "1-4", diamond: true, dot: false },
      { day: 85, book: "1 Samuel", chapters: "1-2", diamond: true, dot: false },
      { day: 86, book: "1 Samuel", chapters: "3-6", diamond: true, dot: false },
      { day: 87, book: "1 Samuel", chapters: "7-9", diamond: true, dot: false },
      { day: 88, book: "1 Samuel", chapters: "10-12", diamond: true, dot: false },
      { day: 89, book: "1 Samuel", chapters: "13-14", diamond: true, dot: false },
      { day: 90, book: "1 Samuel", chapters: "15-16", diamond: true, dot: false },
      { day: 91, book: "1 Samuel", chapters: "17-18", diamond: true, dot: false },
      { day: 92, book: "1 Samuel", chapters: "19-21", diamond: true, dot: false },
      { day: 93, book: "1 Samuel", chapters: "22-24", diamond: true, dot: false },
      { day: 94, book: "1 Samuel", chapters: "25-27", diamond: true, dot: false },
      { day: 95, book: "1 Samuel", chapters: "28-31", diamond: true, dot: false },
      { day: 96, book: "2 Samuel", chapters: "1-2", diamond: true, dot: false },
      { day: 97, book: "2 Samuel", chapters: "3-5", diamond: true, dot: false },
      { day: 98, book: "2 Samuel", chapters: "6-8", diamond: true, dot: false },
      { day: 99, book: "2 Samuel", chapters: "9-12", diamond: true, dot: false },
      { day: 100, book: "2 Samuel", chapters: "13-14", diamond: true, dot: false },
      { day: 101, book: "2 Samuel", chapters: "15-16", diamond: true, dot: false },
      { day: 102, book: "2 Samuel", chapters: "17-18", diamond: true, dot: false },
      { day: 103, book: "2 Samuel", chapters: "19-20", diamond: true, dot: false },
      { day: 104, book: "2 Samuel", chapters: "21-22", diamond: true, dot: false },
      { day: 105, book: "2 Samuel", chapters: "23-24", diamond: true, dot: false },
      { day: 106, book: "1 Kings", chapters: "1-2", diamond: true, dot: false },
      { day: 107, book: "1 Kings", chapters: "3-5", diamond: true, dot: false },
      { day: 108, book: "1 Kings", chapters: "6-7", diamond: true, dot: false },
      { day: 109, book: "1 Kings", chapters: "8", diamond: true, dot: false },
      { day: 110, book: "1 Kings", chapters: "9-10", diamond: true, dot: false },
      { day: 111, book: "1 Kings", chapters: "11-12", diamond: true, dot: false },
      { day: 112, book: "1 Kings", chapters: "13-14", diamond: true, dot: false },
      { day: 113, book: "1 Kings", chapters: "15-17", diamond: true, dot: false },
      { day: 114, book: "1 Kings", chapters: "18-19", diamond: true, dot: false },
      { day: 115, book: "1 Kings", chapters: "20-21", diamond: true, dot: false },
      { day: 116, book: "1 Kings", chapters: "22", diamond: true, dot: false },
      { day: 117, book: "2 Kings", chapters: "1-3", diamond: true, dot: false },
      { day: 118, book: "2 Kings", chapters: "4-5", diamond: true, dot: false },
      { day: 119, book: "2 Kings", chapters: "6-8", diamond: true, dot: false },
      { day: 120, book: "2 Kings", chapters: "9-10", diamond: true, dot: false },
      { day: 121, book: "2 Kings", chapters: "11-13", diamond: true, dot: false },
      { day: 122, book: "2 Kings", chapters: "14-15", diamond: true, dot: false },
      { day: 123, book: "2 Kings", chapters: "16-17", diamond: true, dot: false },
      { day: 124, book: "2 Kings", chapters: "18-19", diamond: true, dot: false },
      { day: 125, book: "2 Kings", chapters: "20-22", diamond: true, dot: false },
      { day: 126, book: "2 Kings", chapters: "23-25", diamond: true, dot: false },
      { day: 127, book: "1 Chronicles", chapters: "1-2", diamond: false, dot: false },
      { day: 128, book: "1 Chronicles", chapters: "3-5", diamond: false, dot: false },
      { day: 129, book: "1 Chronicles", chapters: "6-7", diamond: false, dot: false },
      { day: 130, book: "1 Chronicles", chapters: "8-10", diamond: false, dot: false },
      { day: 131, book: "1 Chronicles", chapters: "11-12", diamond: false, dot: false },
      { day: 132, book: "1 Chronicles", chapters: "13-15", diamond: false, dot: false },
      { day: 133, book: "1 Chronicles", chapters: "16-17", diamond: false, dot: false },
      { day: 134, book: "1 Chronicles", chapters: "18-20", diamond: false, dot: false },
      { day: 135, book: "1 Chronicles", chapters: "21-23", diamond: false, dot: false },
      { day: 136, book: "1 Chronicles", chapters: "24-26", diamond: false, dot: false },
      { day: 137, book: "1 Chronicles", chapters: "27-29", diamond: false, dot: false },
      { day: 138, book: "2 Chronicles", chapters: "1-3", diamond: false, dot: false },
      { day: 139, book: "2 Chronicles", chapters: "4-6", diamond: false, dot: false },
      { day: 140, book: "2 Chronicles", chapters: "7-9", diamond: false, dot: false },
      { day: 141, book: "2 Chronicles", chapters: "10-14", diamond: false, dot: false },
      { day: 142, book: "2 Chronicles", chapters: "15-18", diamond: false, dot: false },
      { day: 143, book: "2 Chronicles", chapters: "19-22", diamond: false, dot: false },
      { day: 144, book: "2 Chronicles", chapters: "23-25", diamond: false, dot: false },
      { day: 145, book: "2 Chronicles", chapters: "26-28", diamond: false, dot: false },
      { day: 146, book: "2 Chronicles", chapters: "29-30", diamond: false, dot: false },
      { day: 147, book: "2 Chronicles", chapters: "31-33", diamond: false, dot: false },
      { day: 148, book: "2 Chronicles", chapters: "34-36", diamond: false, dot: false },
      { day: 149, book: "Ezra", chapters: "1-3", diamond: true, dot: false },
      { day: 150, book: "Ezra", chapters: "4-7", diamond: true, dot: false },
      { day: 151, book: "Ezra", chapters: "8-10", diamond: true, dot: false },
      { day: 152, book: "Nehemiah", chapters: "1-3", diamond: true, dot: false },
      { day: 153, book: "Nehemiah", chapters: "4-6", diamond: true, dot: false },
      { day: 154, book: "Nehemiah", chapters: "7-8", diamond: true, dot: false },
      { day: 155, book: "Nehemiah", chapters: "9-10", diamond: true, dot: false },
      { day: 156, book: "Nehemiah", chapters: "11-13", diamond: true, dot: false },
      { day: 157, book: "Esther", chapters: "1-4", diamond: true, dot: false },
      { day: 158, book: "Esther", chapters: "5-10", diamond: true, dot: false },
      { day: 159, book: "Job", chapters: "1-5", diamond: false, dot: false },
      { day: 160, book: "Job", chapters: "6-9", diamond: false, dot: false },
      { day: 161, book: "Job", chapters: "10-14", diamond: false, dot: false },
      { day: 162, book: "Job", chapters: "15-18", diamond: false, dot: false },
      { day: 163, book: "Job", chapters: "19-20", diamond: false, dot: false },
      { day: 164, book: "Job", chapters: "21-24", diamond: false, dot: false },
      { day: 165, book: "Job", chapters: "25-29", diamond: false, dot: false },
      { day: 166, book: "Job", chapters: "30-31", diamond: false, dot: false },
      { day: 167, book: "Job", chapters: "32-34", diamond: false, dot: false },
      { day: 168, book: "Job", chapters: "35-38", diamond: false, dot: false },
      { day: 169, book: "Job", chapters: "39-42", diamond: false, dot: false },
      { day: 170, book: "Psalms", chapters: "1-8", diamond: false, dot: false },
      { day: 171, book: "Psalms", chapters: "9-16", diamond: false, dot: false },
      { day: 172, book: "Psalms", chapters: "17-19", diamond: false, dot: false },
      { day: 173, book: "Psalms", chapters: "20-25", diamond: false, dot: false },
      { day: 174, book: "Psalms", chapters: "26-31", diamond: false, dot: false },
      { day: 175, book: "Psalms", chapters: "32-35", diamond: false, dot: false },
      { day: 176, book: "Psalms", chapters: "36-38", diamond: false, dot: false },
      { day: 177, book: "Psalms", chapters: "39-42", diamond: false, dot: false },
      { day: 178, book: "Psalms", chapters: "43-47", diamond: false, dot: false },
      { day: 179, book: "Psalms", chapters: "48-52", diamond: false, dot: false },
      { day: 180, book: "Psalms", chapters: "53-58", diamond: false, dot: false },
      { day: 181, book: "Psalms", chapters: "59-64", diamond: false, dot: false },
      { day: 182, book: "Psalms", chapters: "65-68", diamond: false, dot: false },
      { day: 183, book: "Psalms", chapters: "69-72", diamond: false, dot: false },
      { day: 184, book: "Psalms", chapters: "73-77", diamond: false, dot: false },
      { day: 185, book: "Psalms", chapters: "78-79", diamond: false, dot: false },
      { day: 186, book: "Psalms", chapters: "80-86", diamond: false, dot: false },
      { day: 187, book: "Psalms", chapters: "87-90", diamond: false, dot: false },
      { day: 188, book: "Psalms", chapters: "91-96", diamond: false, dot: false },
      { day: 189, book: "Psalms", chapters: "97-103", diamond: false, dot: false },
      { day: 190, book: "Psalms", chapters: "104-105", diamond: false, dot: false },
      { day: 191, book: "Psalms", chapters: "106-108", diamond: false, dot: false },
      { day: 192, book: "Psalms", chapters: "109-115", diamond: false, dot: false },
      { day: 193, book: "Psalms", chapters: "116-119:63", diamond: false, dot: false },
      { day: 194, book: "Psalms", chapters: "119:64-176", diamond: false, dot: false },
      { day: 195, book: "Psalms", chapters: "120-129", diamond: false, dot: false },
      { day: 196, book: "Psalms", chapters: "130-138", diamond: false, dot: false },
      { day: 197, book: "Psalms", chapters: "139-144", diamond: false, dot: false },
      { day: 198, book: "Psalms", chapters: "145-150", diamond: false, dot: false },
      { day: 199, book: "Proverbs", chapters: "1-4", diamond: false, dot: false },
      { day: 200, book: "Proverbs", chapters: "5-8", diamond: false, dot: false },
      { day: 201, book: "Proverbs", chapters: "9-12", diamond: false, dot: false },
      { day: 202, book: "Proverbs", chapters: "13-16", diamond: false, dot: false },
      { day: 203, book: "Proverbs", chapters: "17-19", diamond: false, dot: false },
      { day: 204, book: "Proverbs", chapters: "20-22", diamond: false, dot: false },
      { day: 205, book: "Proverbs", chapters: "23-27", diamond: false, dot: false },
      { day: 206, book: "Proverbs", chapters: "28-31", diamond: false, dot: false },
      { day: 207, book: "Ecclesiastes", chapters: "1-4", diamond: false, dot: false },
      { day: 208, book: "Ecclesiastes", chapters: "5-8", diamond: false, dot: false },
      { day: 209, book: "Ecclesiastes", chapters: "9-12", diamond: false, dot: false },
      { day: 210, book: "Song of Solomon", chapters: "1-8", diamond: false, dot: false },
      { day: 211, book: "Isaiah", chapters: "1-4", diamond: false, dot: false },
      { day: 212, book: "Isaiah", chapters: "5-7", diamond: false, dot: false },
      { day: 213, book: "Isaiah", chapters: "8-10", diamond: false, dot: false },
      { day: 214, book: "Isaiah", chapters: "11-14", diamond: false, dot: false },
      { day: 215, book: "Isaiah", chapters: "15-19", diamond: false, dot: false },
      { day: 216, book: "Isaiah", chapters: "20-24", diamond: false, dot: false },
      { day: 217, book: "Isaiah", chapters: "25-28", diamond: false, dot: false },
      { day: 218, book: "Isaiah", chapters: "29-31", diamond: false, dot: false },
      { day: 219, book: "Isaiah", chapters: "32-35", diamond: false, dot: false },
      { day: 220, book: "Isaiah", chapters: "36-37", diamond: false, dot: false },
      { day: 221, book: "Isaiah", chapters: "38-40", diamond: false, dot: false },
      { day: 222, book: "Isaiah", chapters: "41-43", diamond: false, dot: false },
      { day: 223, book: "Isaiah", chapters: "44-47", diamond: false, dot: false },
      { day: 224, book: "Isaiah", chapters: "48-50", diamond: false, dot: false },
      { day: 225, book: "Isaiah", chapters: "51-55", diamond: false, dot: false },
      { day: 226, book: "Isaiah", chapters: "56-58", diamond: false, dot: false },
      { day: 227, book: "Isaiah", chapters: "59-62", diamond: false, dot: false },
      { day: 228, book: "Isaiah", chapters: "63-66", diamond: false, dot: false },
      { day: 229, book: "Jeremiah", chapters: "1-3", diamond: false, dot: false },
      { day: 230, book: "Jeremiah", chapters: "4-5", diamond: false, dot: false },
      { day: 231, book: "Jeremiah", chapters: "6-7", diamond: false, dot: false },
      { day: 232, book: "Jeremiah", chapters: "8-10", diamond: false, dot: false },
      { day: 233, book: "Jeremiah", chapters: "11-13", diamond: false, dot: false },
      { day: 234, book: "Jeremiah", chapters: "14-16", diamond: false, dot: false },
      { day: 235, book: "Jeremiah", chapters: "17-20", diamond: false, dot: false },
      { day: 236, book: "Jeremiah", chapters: "21-23", diamond: false, dot: false },
      { day: 237, book: "Jeremiah", chapters: "24-26", diamond: false, dot: false },
      { day: 238, book: "Jeremiah", chapters: "27-29", diamond: false, dot: false },
      { day: 239, book: "Jeremiah", chapters: "30-31", diamond: false, dot: false },
      { day: 240, book: "Jeremiah", chapters: "32-33", diamond: false, dot: false },
      { day: 241, book: "Jeremiah", chapters: "34-36", diamond: false, dot: false },
      { day: 242, book: "Jeremiah", chapters: "37-39", diamond: false, dot: false },
      { day: 243, book: "Jeremiah", chapters: "40-42", diamond: false, dot: false },
      { day: 244, book: "Jeremiah", chapters: "43-44", diamond: false, dot: false },
      { day: 245, book: "Jeremiah", chapters: "45-48", diamond: false, dot: false },
      { day: 246, book: "Jeremiah", chapters: "49-50", diamond: false, dot: false },
      { day: 247, book: "Jeremiah", chapters: "51-52", diamond: false, dot: false },
      { day: 248, book: "Lamentations", chapters: "1-2", diamond: false, dot: false },
      { day: 249, book: "Lamentations", chapters: "3-5", diamond: false, dot: false },
      { day: 250, book: "Ezekiel", chapters: "1-3", diamond: false, dot: false },
      { day: 251, book: "Ezekiel", chapters: "4-6", diamond: false, dot: false },
      { day: 252, book: "Ezekiel", chapters: "7-9", diamond: false, dot: false },
      { day: 253, book: "Ezekiel", chapters: "10-12", diamond: false, dot: false },
      { day: 254, book: "Ezekiel", chapters: "13-15", diamond: false, dot: false },
      { day: 255, book: "Ezekiel", chapters: "16", diamond: false, dot: false },
      { day: 256, book: "Ezekiel", chapters: "17-18", diamond: false, dot: false },
      { day: 257, book: "Ezekiel", chapters: "19-21", diamond: false, dot: false },
      { day: 258, book: "Ezekiel", chapters: "22-23", diamond: false, dot: false },
      { day: 259, book: "Ezekiel", chapters: "24-26", diamond: false, dot: false },
      { day: 260, book: "Ezekiel", chapters: "27-28", diamond: false, dot: false },
      { day: 261, book: "Ezekiel", chapters: "29-31", diamond: false, dot: false },
      { day: 262, book: "Ezekiel", chapters: "32-33", diamond: false, dot: false },
      { day: 263, book: "Ezekiel", chapters: "34-36", diamond: false, dot: false },
      { day: 264, book: "Ezekiel", chapters: "37-38", diamond: false, dot: false },
      { day: 265, book: "Ezekiel", chapters: "39-40", diamond: false, dot: false },
      { day: 266, book: "Ezekiel", chapters: "41-43", diamond: false, dot: false },
      { day: 267, book: "Ezekiel", chapters: "44-45", diamond: false, dot: false },
      { day: 268, book: "Ezekiel", chapters: "46-48", diamond: false, dot: false },
      { day: 269, book: "Daniel", chapters: "1-2", diamond: false, dot: false },
      { day: 270, book: "Daniel", chapters: "3-4", diamond: false, dot: false },
      { day: 271, book: "Daniel", chapters: "5-7", diamond: false, dot: false },
      { day: 272, book: "Daniel", chapters: "8-10", diamond: false, dot: false },
      { day: 273, book: "Daniel", chapters: "11-12", diamond: false, dot: false },
      { day: 274, book: "Hosea", chapters: "1-7", diamond: false, dot: false },
      { day: 275, book: "Hosea", chapters: "8-14", diamond: false, dot: false },
      { day: 276, book: "Joel", chapters: "1-3", diamond: false, dot: false },
      { day: 277, book: "Amos", chapters: "1-5", diamond: false, dot: false },
      { day: 278, book: "Amos", chapters: "6-9", diamond: false, dot: false },
      { day: 279, book: "Obadiah/Jonah", chapters: "", diamond: false, dot: false },
      { day: 280, book: "Micah", chapters: "1-7", diamond: false, dot: false },
      { day: 281, book: "Nahum/Habakkuk", chapters: "", diamond: false, dot: false },
      { day: 282, book: "Zephaniah/Haggai", chapters: "", diamond: false, dot: false },
      { day: 283, book: "Zechariah", chapters: "1-7", diamond: false, dot: false },
      { day: 284, book: "Zechariah", chapters: "8-11", diamond: false, dot: false },
      { day: 285, book: "Zechariah", chapters: "12-14", diamond: false, dot: false },
      { day: 286, book: "Malachi", chapters: "1-4", diamond: false, dot: false },
      { day: 287, book: "Matthew", chapters: "1-4", diamond: false, dot: false },
      { day: 288, book: "Matthew", chapters: "5-7", diamond: false, dot: false },
      { day: 289, book: "Matthew", chapters: "8-10", diamond: false, dot: false },
      { day: 290, book: "Matthew", chapters: "11-13", diamond: false, dot: false },
      { day: 291, book: "Matthew", chapters: "14-17", diamond: false, dot: false },
      { day: 292, book: "Matthew", chapters: "18-20", diamond: false, dot: false },
      { day: 293, book: "Matthew", chapters: "21-23", diamond: false, dot: false },
      { day: 294, book: "Matthew", chapters: "24-25", diamond: false, dot: false },
      { day: 295, book: "Matthew", chapters: "26", diamond: false, dot: false },
      { day: 296, book: "Matthew", chapters: "27-28", diamond: false, dot: false },
      { day: 297, book: "Mark", chapters: "1-3", diamond: false, dot: true },
      { day: 298, book: "Mark", chapters: "4-5", diamond: false, dot: true },
      { day: 299, book: "Mark", chapters: "6-8", diamond: false, dot: true },
      { day: 300, book: "Mark", chapters: "9-10", diamond: false, dot: true },
      { day: 301, book: "Mark", chapters: "11-13", diamond: false, dot: true },
      { day: 302, book: "Mark", chapters: "14-16", diamond: false, dot: true },
      { day: 303, book: "Luke", chapters: "1-2", diamond: false, dot: false },
      { day: 304, book: "Luke", chapters: "3-5", diamond: false, dot: false },
      { day: 305, book: "Luke", chapters: "6-7", diamond: false, dot: false },
      { day: 306, book: "Luke", chapters: "8-9", diamond: false, dot: false },
      { day: 307, book: "Luke", chapters: "10-11", diamond: false, dot: false },
      { day: 308, book: "Luke", chapters: "12-13", diamond: false, dot: false },
      { day: 309, book: "Luke", chapters: "14-17", diamond: false, dot: false },
      { day: 310, book: "Luke", chapters: "18-19", diamond: false, dot: false },
      { day: 311, book: "Luke", chapters: "20-22", diamond: false, dot: false },
      { day: 312, book: "Luke", chapters: "23-24", diamond: false, dot: false },
      { day: 313, book: "John", chapters: "1-3", diamond: false, dot: false },
      { day: 314, book: "John", chapters: "4-5", diamond: false, dot: false },
      { day: 315, book: "John", chapters: "6-7", diamond: false, dot: false },
      { day: 316, book: "John", chapters: "8-9", diamond: false, dot: false },
      { day: 317, book: "John", chapters: "10-12", diamond: false, dot: false },
      { day: 318, book: "John", chapters: "13-15", diamond: false, dot: false },
      { day: 319, book: "John", chapters: "16-18", diamond: false, dot: false },
      { day: 320, book: "John", chapters: "19-21", diamond: false, dot: false },
      { day: 321, book: "Acts", chapters: "1-3", diamond: false, dot: true },
      { day: 322, book: "Acts", chapters: "4-6", diamond: false, dot: true },
      { day: 323, book: "Acts", chapters: "7-8", diamond: false, dot: true },
      { day: 324, book: "Acts", chapters: "9-11", diamond: false, dot: true },
      { day: 325, book: "Acts", chapters: "12-14", diamond: false, dot: true },
      { day: 326, book: "Acts", chapters: "15-16", diamond: false, dot: true },
      { day: 327, book: "Acts", chapters: "17-19", diamond: false, dot: true },
      { day: 328, book: "Acts", chapters: "20-21", diamond: false, dot: true },
      { day: 329, book: "Acts", chapters: "22-23", diamond: false, dot: true },
      { day: 330, book: "Acts", chapters: "24-26", diamond: false, dot: true },
      { day: 331, book: "Acts", chapters: "27-28", diamond: false, dot: true },
      { day: 332, book: "Romans", chapters: "1-3", diamond: false, dot: false },
      { day: 333, book: "Romans", chapters: "4-7", diamond: false, dot: false },
      { day: 334, book: "Romans", chapters: "8-11", diamond: false, dot: false },
      { day: 335, book: "Romans", chapters: "12-16", diamond: false, dot: false },
      { day: 336, book: "1 Corinthians", chapters: "1-6", diamond: false, dot: false },
      { day: 337, book: "1 Corinthians", chapters: "7-10", diamond: false, dot: false },
      { day: 338, book: "1 Corinthians", chapters: "11-14", diamond: false, dot: false },
      { day: 339, book: "1 Corinthians", chapters: "15-16", diamond: false, dot: false },
      { day: 340, book: "2 Corinthians", chapters: "1-6", diamond: false, dot: false },
      { day: 341, book: "2 Corinthians", chapters: "7-10", diamond: false, dot: false },
      { day: 342, book: "2 Corinthians", chapters: "11-13", diamond: false, dot: false },
      { day: 343, book: "Galatians", chapters: "1-6", diamond: false, dot: false },
      { day: 344, book: "Ephesians", chapters: "1-6", diamond: false, dot: false },
      { day: 345, book: "Philippians", chapters: "1-4", diamond: false, dot: false },
      { day: 346, book: "Colossians", chapters: "1-4", diamond: false, dot: false },
      { day: 347, book: "1 Thessalonians", chapters: "1-5", diamond: false, dot: false },
      { day: 348, book: "2 Thessalonians", chapters: "1-3", diamond: false, dot: false },
      { day: 349, book: "1 Timothy", chapters: "1-6", diamond: false, dot: false },
      { day: 350, book: "2 Timothy", chapters: "1-4", diamond: false, dot: false },
      { day: 351, book: "Titus/Philemon", chapters: "", diamond: false, dot: false },
      { day: 352, book: "Hebrews", chapters: "1-6", diamond: false, dot: false },
      { day: 353, book: "Hebrews", chapters: "7-10", diamond: false, dot: false },
      { day: 354, book: "Hebrews", chapters: "11-13", diamond: false, dot: false },
      { day: 355, book: "James", chapters: "1-5", diamond: false, dot: false },
      { day: 356, book: "1 Peter", chapters: "1-5", diamond: false, dot: false },
      { day: 357, book: "2 Peter", chapters: "1-3", diamond: false, dot: false },
      { day: 358, book: "1 John", chapters: "1-5", diamond: false, dot: false },
      { day: 359, book: "2 John/3 John/Jude", chapters: "", diamond: false, dot: false },
      { day: 360, book: "Revelation", chapters: "1-4", diamond: false, dot: false },
      { day: 361, book: "Revelation", chapters: "5-9", diamond: false, dot: false },
      { day: 362, book: "Revelation", chapters: "10-14", diamond: false, dot: false },
      { day: 363, book: "Revelation", chapters: "15-18", diamond: false, dot: false },
      { day: 364, book: "Revelation", chapters: "19-22", diamond: false, dot: false },
    ];

    const READINGS_CHRONO = [
      { day: 1, book: "Genesis", chapters: "Genesis 1, 2", diamond: false, dot: false },
      { day: 2, book: "Genesis", chapters: "Genesis 3-5", diamond: false, dot: false },
      { day: 3, book: "Genesis", chapters: "Genesis 6-9", diamond: false, dot: false },
      { day: 4, book: "Genesis", chapters: "Genesis 10, 11; 1 Chronicles 1:1-27", diamond: false, dot: false },
      { day: 5, book: "Job", chapters: "Job 1-3", diamond: false, dot: false },
      { day: 6, book: "Job", chapters: "Job 4-7", diamond: false, dot: false },
      { day: 7, book: "Job", chapters: "Job 8-10", diamond: false, dot: false },
      { day: 8, book: "Job", chapters: "Job 11-14", diamond: false, dot: false },
      { day: 9, book: "Job", chapters: "Job 15-18", diamond: false, dot: false },
      { day: 10, book: "Job", chapters: "Job 19-21", diamond: false, dot: false },
      { day: 11, book: "Job", chapters: "Job 22-26", diamond: false, dot: false },
      { day: 12, book: "Job", chapters: "Job 27-29", diamond: false, dot: false },
      { day: 13, book: "Job", chapters: "Job 30, 31", diamond: false, dot: false },
      { day: 14, book: "Job", chapters: "Job 32-34", diamond: false, dot: false },
      { day: 15, book: "Job", chapters: "Job 35-37", diamond: false, dot: false },
      { day: 16, book: "Job", chapters: "Job 38, 39", diamond: false, dot: false },
      { day: 17, book: "Job", chapters: "Job 40-42", diamond: false, dot: false },
      { day: 18, book: "Genesis", chapters: "Genesis 12, 13", diamond: false, dot: false },
      { day: 19, book: "Genesis", chapters: "Genesis 14, 15", diamond: false, dot: false },
      { day: 20, book: "Genesis", chapters: "Genesis 16", diamond: false, dot: false },
      { day: 21, book: "Genesis", chapters: "Genesis 17", diamond: false, dot: false },
      { day: 22, book: "Genesis", chapters: "Genesis 18", diamond: false, dot: false },
      { day: 23, book: "Genesis", chapters: "Genesis 19-21; 25:12-18; 1 Chronicles 1:28-31", diamond: false, dot: false },
      { day: 24, book: "Genesis", chapters: "Genesis 22-24", diamond: false, dot: false },
      { day: 25, book: "Genesis", chapters: "Genesis 25:1-4; 1 Chronicles 1:32-34; Genesis 25:5-11; 25:19-26:35", diamond: false, dot: false },
      { day: 26, book: "Genesis", chapters: "Genesis 27:1-28:9; 36; 1 Chronicles 1:35-54", diamond: false, dot: false },
      { day: 27, book: "Genesis", chapters: "Genesis 28:10-30:43", diamond: false, dot: false },
      { day: 28, book: "Genesis", chapters: "Genesis 31, 32", diamond: false, dot: false },
      { day: 29, book: "Genesis", chapters: "Genesis 33-35; 1 Chronicles 2:1, 2", diamond: false, dot: false },
      { day: 30, book: "Genesis", chapters: "Genesis 37-39", diamond: false, dot: false },
      { day: 31, book: "Genesis", chapters: "Genesis 40, 41", diamond: false, dot: false },
      { day: 32, book: "Genesis", chapters: "Genesis 42-44", diamond: false, dot: false },
      { day: 33, book: "Genesis", chapters: "Genesis 45:1-46:9; 1 Chronicles 5:1-6; Genesis 46:10-12; 1 Chronicles 2:18-55", diamond: false, dot: false },
      { day: 34, book: "1 Chronicles", chapters: "1 Chronicles 4:1-23; Genesis 46:13; 1 Chronicles 7:1-5; Genesis 46:14-18; 1 Chronicles 7:30-40; Genesis 46:19-25; 1 Chronicles 7:6-12; Genesis 46:26-47:12", diamond: false, dot: false },
      { day: 35, book: "Genesis", chapters: "Genesis 47:13-50:26", diamond: false, dot: false },
      { day: 36, book: "Exodus", chapters: "Exodus 1:1-4:17", diamond: false, dot: false },
      { day: 37, book: "Exodus", chapters: "Exodus 4:18-6:27; 1 Chronicles 6:1-4; Exodus 6:28-7:13", diamond: false, dot: false },
      { day: 38, book: "Exodus", chapters: "Exodus 7:14-9:35", diamond: false, dot: false },
      { day: 39, book: "Exodus", chapters: "Exodus 10-12", diamond: false, dot: false },
      { day: 40, book: "Exodus", chapters: "Exodus 13-15", diamond: false, dot: false },
      { day: 41, book: "Exodus", chapters: "Exodus 16-18", diamond: false, dot: false },
      { day: 42, book: "Exodus", chapters: "Exodus 19-21", diamond: false, dot: false },
      { day: 43, book: "Exodus", chapters: "Exodus 22-24", diamond: false, dot: false },
      { day: 44, book: "Exodus", chapters: "Exodus 25-27", diamond: false, dot: false },
      { day: 45, book: "Exodus", chapters: "Exodus 28, 29", diamond: false, dot: false },
      { day: 46, book: "Exodus", chapters: "Exodus 30:1-33:6", diamond: false, dot: false },
      { day: 47, book: "Exodus", chapters: "Exodus 33:7-36:7", diamond: false, dot: false },
      { day: 48, book: "Exodus", chapters: "Exodus 36:8-38:31", diamond: false, dot: false },
      { day: 49, book: "Exodus", chapters: "Exodus 39, 40", diamond: false, dot: false },
      { day: 50, book: "Leviticus", chapters: "Leviticus 1-4", diamond: false, dot: false },
      { day: 51, book: "Leviticus", chapters: "Leviticus 5-7", diamond: false, dot: false },
      { day: 52, book: "Leviticus", chapters: "Leviticus 8-10", diamond: false, dot: false },
      { day: 53, book: "Leviticus", chapters: "Leviticus 11:1-13:46", diamond: false, dot: false },
      { day: 54, book: "Leviticus", chapters: "Leviticus 13:47-15:33", diamond: false, dot: false },
      { day: 55, book: "Leviticus", chapters: "Leviticus 16-18", diamond: false, dot: false },
      { day: 56, book: "Leviticus", chapters: "Leviticus 19-21", diamond: false, dot: false },
      { day: 57, book: "Leviticus", chapters: "Leviticus 22, 23", diamond: false, dot: false },
      { day: 58, book: "Leviticus", chapters: "Leviticus 24, 25", diamond: false, dot: false },
      { day: 59, book: "Leviticus", chapters: "Leviticus 26, 27", diamond: false, dot: false },
      { day: 60, book: "Numbers", chapters: "Numbers 1, 2", diamond: false, dot: false },
      { day: 61, book: "Numbers", chapters: "Numbers 3:1-4:33", diamond: false, dot: false },
      { day: 62, book: "Numbers", chapters: "Numbers 4:34-6:27", diamond: false, dot: false },
      { day: 63, book: "Numbers", chapters: "Numbers 7", diamond: false, dot: false },
      { day: 64, book: "Numbers", chapters: "Numbers 8-10", diamond: false, dot: false },
      { day: 65, book: "Numbers", chapters: "Numbers 11-13", diamond: false, dot: false },
      { day: 66, book: "Numbers", chapters: "Numbers 14, 15", diamond: false, dot: false },
      { day: 67, book: "Numbers", chapters: "Numbers 16-18", diamond: false, dot: false },
      { day: 68, book: "Numbers", chapters: "Numbers 19-21", diamond: false, dot: false },
      { day: 69, book: "Numbers", chapters: "Numbers 22-24", diamond: false, dot: false },
      { day: 70, book: "Numbers", chapters: "Numbers 25:1-26:34; 1 Chronicles 7:13-19; Numbers 26:35-37; 1 Chronicles 7:20-29; Numbers 26:38-65", diamond: false, dot: false },
      { day: 71, book: "Numbers", chapters: "Numbers 27-29", diamond: false, dot: false },
      { day: 72, book: "Numbers", chapters: "Numbers 30, 31", diamond: false, dot: false },
      { day: 73, book: "Numbers", chapters: "Numbers 32, 33", diamond: false, dot: false },
      { day: 74, book: "Numbers", chapters: "Numbers 34-36", diamond: false, dot: false },
      { day: 75, book: "Deuteronomy", chapters: "Deuteronomy 1:1-3:11", diamond: false, dot: false },
      { day: 76, book: "Deuteronomy", chapters: "Deuteronomy 3:12-5:33", diamond: false, dot: false },
      { day: 77, book: "Deuteronomy", chapters: "Deuteronomy 6-8", diamond: false, dot: false },
      { day: 78, book: "Deuteronomy", chapters: "Deuteronomy 9-11", diamond: false, dot: false },
      { day: 79, book: "Deuteronomy", chapters: "Deuteronomy 12-14", diamond: false, dot: false },
      { day: 80, book: "Deuteronomy", chapters: "Deuteronomy 15-18", diamond: false, dot: false },
      { day: 81, book: "Deuteronomy", chapters: "Deuteronomy 19-22", diamond: false, dot: false },
      { day: 82, book: "Deuteronomy", chapters: "Deuteronomy 23-26", diamond: false, dot: false },
      { day: 83, book: "Deuteronomy", chapters: "Deuteronomy 27, 28", diamond: false, dot: false },
      { day: 84, book: "Deuteronomy", chapters: "Deuteronomy 29:1-31:29", diamond: false, dot: false },
      { day: 85, book: "Deuteronomy", chapters: "Deuteronomy 31:30-32:52; Psalms 90", diamond: false, dot: false },
      { day: 86, book: "Deuteronomy", chapters: "Deuteronomy 33, 34; Joshua 1, 2", diamond: false, dot: false },
      { day: 87, book: "Joshua", chapters: "Joshua 3-6", diamond: false, dot: false },
      { day: 88, book: "Joshua", chapters: "Joshua 7-9", diamond: false, dot: false },
      { day: 89, book: "Joshua", chapters: "Joshua 10-12", diamond: false, dot: false },
      { day: 90, book: "Joshua", chapters: "Joshua 13-15", diamond: false, dot: false },
      { day: 91, book: "Joshua", chapters: "Joshua 16:1-19:9; 1 Chronicles 4:24-33; Joshua 19:10-31", diamond: false, dot: false },
      { day: 92, book: "Joshua", chapters: "Joshua 19:32-21:45; 1 Chronicles 6:54-81", diamond: false, dot: false },
      { day: 93, book: "Joshua", chapters: "Joshua 22-24", diamond: false, dot: false },
      { day: 94, book: "Judges", chapters: "Judges 1:1-3:6; 17", diamond: false, dot: false },
      { day: 95, book: "Judges", chapters: "Judges 18; 3:7-4:24", diamond: false, dot: false },
      { day: 96, book: "Judges", chapters: "Judges 5-7", diamond: false, dot: false },
      { day: 97, book: "Judges", chapters: "Judges 8, 9", diamond: false, dot: false },
      { day: 98, book: "Judges", chapters: "Judges 10-13", diamond: false, dot: false },
      { day: 99, book: "Judges", chapters: "Judges 14-16", diamond: false, dot: false },
      { day: 100, book: "Judges", chapters: "Judges 19-21", diamond: false, dot: false },
      { day: 101, book: "Ruth", chapters: "Ruth 1-4", diamond: false, dot: false },
      { day: 102, book: "1 Samuel", chapters: "1 Samuel 1-3", diamond: false, dot: false },
      { day: 103, book: "1 Samuel", chapters: "1 Samuel 4-7", diamond: false, dot: false },
      { day: 104, book: "1 Samuel", chapters: "1 Samuel 8-10", diamond: false, dot: false },
      { day: 105, book: "1 Samuel", chapters: "1 Samuel 11-13", diamond: false, dot: false },
      { day: 106, book: "1 Samuel", chapters: "1 Samuel 14, 15", diamond: false, dot: false },
      { day: 107, book: "1 Samuel", chapters: "1 Samuel 16; Psalms 8; 9; 11; 19; 144", diamond: false, dot: false },
      { day: 108, book: "1 Samuel", chapters: "1 Samuel 17, 18; Psalms 23; 58", diamond: false, dot: false },
      { day: 109, book: "1 Samuel", chapters: "1 Samuel 19, 20; Psalms 59; 133", diamond: false, dot: false },
      { day: 110, book: "1 Samuel", chapters: "1 Samuel 21; Psalms 34; 56; 1 Samuel 22:1-5; Psalms 57; 142; 1 Chronicles 12:8-18", diamond: false, dot: false },
      { day: 111, book: "1 Samuel", chapters: "1 Samuel 22:6-23; Psalms 52; 1 Samuel 23; Psalms 54; 63", diamond: false, dot: false },
      { day: 112, book: "Psalms", chapters: "Psalms 13; 22; 1 Samuel 24", diamond: false, dot: false },
      { day: 113, book: "Psalms", chapters: "Psalms 7; 17; 35", diamond: false, dot: false },
      { day: 114, book: "1 Samuel", chapters: "1 Samuel 25; Psalms 14; 53", diamond: false, dot: false },
      { day: 115, book: "2 Samuel", chapters: "2 Samuel 22; Psalms 18; 1 Samuel 26", diamond: false, dot: false },
      { day: 116, book: "1 Samuel", chapters: "1 Samuel 27; Psalms 31; 1 Chronicles 12:1-7; 1 Samuel 28:1-3; 29; 30", diamond: false, dot: false },
      { day: 117, book: "Psalms", chapters: "Psalms 69; 86; 131; 1 Samuel 28:3-25", diamond: false, dot: false },
      { day: 118, book: "1 Samuel", chapters: "1 Samuel 30, 31; 1 Chronicles 10; 2 Samuel 4:4; 1", diamond: false, dot: false },
      { day: 119, book: "2 Samuel", chapters: "2 Samuel 2:1-3:5; 1 Chronicles 3:1-4; 2 Samuel 3:6-4:3; 4:5-5:5; 1 Chronicles 11:1-3", diamond: false, dot: false },
      { day: 120, book: "1 Chronicles", chapters: "1 Chronicles 12:23-40; Psalms 2; 78", diamond: false, dot: false },
      { day: 121, book: "2 Samuel", chapters: "2 Samuel 5:6-10; 1 Chronicles 11:4-9; 2 Samuel 5:17-21; 1 Chronicles 14:8-12; 2 Samuel 23:13-19; 1 Chronicles 11:15-21; 2 Samuel 5:22-25; 1 Chronicles 14:13-17; 2 Samuel 5:11, 12; 1 Chronicles 14:1, 2", diamond: false, dot: false },
      { day: 122, book: "2 Samuel", chapters: "2 Samuel 6:1-11; 1 Chronicles 13; Psalms 101; 2 Samuel 6:12-23; 1 Chronicles 15, 16", diamond: false, dot: false },
      { day: 123, book: "Psalms", chapters: "Psalms 15; 24; 68; 132", diamond: false, dot: false },
      { day: 124, book: "Psalms", chapters: "Psalms 96; 105; 106", diamond: false, dot: false },
      { day: 125, book: "2 Samuel", chapters: "2 Samuel 7; 1 Chronicles 17; Psalms 16; 25; 36", diamond: false, dot: false },
      { day: 126, book: "2 Samuel", chapters: "2 Samuel 8, 9; 1 Chronicles 18; Psalms 60", diamond: false, dot: false },
      { day: 127, book: "2 Samuel", chapters: "2 Samuel 10; 1 Chronicles 19; Psalms 20; 21; 2 Samuel 11", diamond: false, dot: false },
      { day: 128, book: "2 Samuel", chapters: "2 Samuel 12:1-25; Psalms 6; 32; 38; 51", diamond: false, dot: false },
      { day: 129, book: "2 Samuel", chapters: "2 Samuel 12:26-31; 1 Chronicles 20:1-3; Psalms 103; 2 Samuel 23:34; 2 Samuel 13", diamond: false, dot: false },
      { day: 130, book: "2 Samuel", chapters: "2 Samuel 14; Psalms 109; 2 Samuel 15:1-12; Psalms 140; 141", diamond: false, dot: false },
      { day: 131, book: "2 Samuel", chapters: "2 Samuel 15:13-37; Psalms 3; 4; 2 Samuel 16:1-14; Psalms 5; 12; 2 Samuel 16:15-23", diamond: false, dot: false },
      { day: 132, book: "Psalms", chapters: "Psalms 10; 26; 40; 58", diamond: false, dot: false },
      { day: 133, book: "2 Samuel", chapters: "2 Samuel 15:37; 16:15; Psalms 27; 2 Samuel 17", diamond: false, dot: false },
      { day: 134, book: "2 Samuel", chapters: "2 Samuel 16:16-17:23; Psalms 28; 41-43; 55; 64", diamond: false, dot: false },
      { day: 135, book: "2 Samuel", chapters: "2 Samuel 17:24-26; 1 Chronicles 2:17; 2 Samuel 17:27-18:18; Psalms 58; 61, 62", diamond: false, dot: false },
      { day: 136, book: "2 Samuel", chapters: "2 Samuel 18:19-33; Psalms 39; 70, 71; 84; 143; 2 Samuel 19", diamond: false, dot: false },
      { day: 137, book: "2 Samuel", chapters: "2 Samuel 20; Psalms 140, 141; 1 Chronicles 22; Psalms 1; 29; 33", diamond: false, dot: false },
      { day: 138, book: "1 Chronicles", chapters: "1 Chronicles 23:1-23; 6:16-30; 23:24-24:31", diamond: false, dot: false },
      { day: 139, book: "1 Chronicles", chapters: "1 Chronicles 25; 6:31-53; 26", diamond: false, dot: false },
      { day: 140, book: "1 Chronicles", chapters: "1 Chronicles 27:1-29:22", diamond: false, dot: false },
      { day: 141, book: "Psalms", chapters: "Psalms 30; 108; 110; 138; 2 Samuel 23:1-7", diamond: false, dot: false },
      { day: 142, book: "Psalms", chapters: "Psalms 45; 72; 127", diamond: false, dot: false },
      { day: 143, book: "2 Samuel", chapters: "2 Samuel 23:8-12; 1 Chronicles 11:10-14; 2 Samuel 21:15-22; 1 Chronicles 20:4-8; 2 Samuel 23:20-23; 1 Chronicles 11:22-25; 2 Samuel 23:24-39; 1 Chronicles 11:26-47", diamond: false, dot: false },
      { day: 144, book: "2 Samuel", chapters: "2 Samuel 24; 1 Chronicles 21; Psalms 65; 66; 67", diamond: false, dot: false },
      { day: 145, book: "1 Chronicles", chapters: "1 Chronicles 28, 29; 2 Samuel 21:1-14", diamond: false, dot: false },
      { day: 146, book: "1 Kings", chapters: "1 Kings 1, 2; Psalms 37; 79; 94", diamond: false, dot: false },
      { day: 147, book: "1 Kings", chapters: "1 Kings 3; 2 Chronicles 1; Psalms 42; 43; 100", diamond: false, dot: false },
      { day: 148, book: "1 Kings", chapters: "1 Kings 10:1-13; 2 Chronicles 9:1-12; 1 Kings 4:1-19; 4:29-34; Proverbs 1", diamond: false, dot: false },
      { day: 149, book: "Proverbs", chapters: "Proverbs 2-4", diamond: false, dot: false },
      { day: 150, book: "Proverbs", chapters: "Proverbs 5-7", diamond: false, dot: false },
      { day: 151, book: "Proverbs", chapters: "Proverbs 8-10", diamond: false, dot: false },
      { day: 152, book: "Proverbs", chapters: "Proverbs 11-13", diamond: false, dot: false },
      { day: 153, book: "Proverbs", chapters: "Proverbs 14, 15", diamond: false, dot: false },
      { day: 154, book: "Proverbs", chapters: "Proverbs 16-18", diamond: false, dot: false },
      { day: 155, book: "Proverbs", chapters: "Proverbs 19-21", diamond: false, dot: false },
      { day: 156, book: "Proverbs", chapters: "Proverbs 22-24", diamond: false, dot: false },
      { day: 157, book: "Proverbs", chapters: "Proverbs 25-27", diamond: false, dot: false },
      { day: 158, book: "Proverbs", chapters: "Proverbs 28-29", diamond: false, dot: false },
      { day: 159, book: "Proverbs", chapters: "Proverbs 30, 31", diamond: false, dot: false },
      { day: 160, book: "Song of Solomon", chapters: "Song of Solomon 1-4", diamond: false, dot: false },
      { day: 161, book: "Song of Solomon", chapters: "Song of Solomon 5-8; 1 Kings 5; 2 Chronicles 2", diamond: false, dot: false },
      { day: 162, book: "1 Kings", chapters: "1 Kings 6; 2 Chronicles 3; 1 Kings 7:1-22; 2 Chronicles 4:1-22", diamond: false, dot: false },
      { day: 163, book: "1 Kings", chapters: "1 Kings 4:20-28; 7:23-51; 2 Chronicles 4:1-5:1", diamond: false, dot: false },
      { day: 164, book: "1 Kings", chapters: "1 Kings 8:1-53; 2 Chronicles 5:2-6:42", diamond: false, dot: false },
      { day: 165, book: "1 Kings", chapters: "1 Kings 8:54-9:23; 2 Chronicles 7:1-8:10", diamond: false, dot: false },
      { day: 166, book: "1 Kings", chapters: "1 Kings 9:24; 2 Chronicles 8:11; 1 Kings 11:41-43; 2 Chronicles 9:29-31; 1 Kings 9:25; 2 Chronicles 8:12-16; 1 Kings 9:17-19; 2 Chronicles 8:4-6; 1 Kings 9:26-28; 2 Chronicles 8:17, 18; 1 Kings 10:22; 2 Chronicles 9:21", diamond: false, dot: false },
      { day: 167, book: "Ecclesiastes", chapters: "Ecclesiastes 1-4", diamond: false, dot: false },
      { day: 168, book: "Ecclesiastes", chapters: "Ecclesiastes 5-8", diamond: false, dot: false },
      { day: 169, book: "Ecclesiastes", chapters: "Ecclesiastes 9-12", diamond: false, dot: false },
      { day: 170, book: "1 Kings", chapters: "1 Kings 10:14-29; 2 Chronicles 9:13-28; 1 Kings 11:1-40; Psalms 81", diamond: false, dot: false },
      { day: 171, book: "Psalms", chapters: "Psalms 113; 116; 120; 122; 124; 129", diamond: false, dot: false },
      { day: 172, book: "Psalms", chapters: "Psalms 111; 112; 144", diamond: false, dot: false },
      { day: 173, book: "2 Chronicles", chapters: "2 Chronicles 1:14-17; 1 Kings 4:21-28; 10:22; 2 Chronicles 9:21; 1 Kings 10:1-13; 2 Chronicles 9:1-12; Psalm 47", diamond: false, dot: false },
      { day: 174, book: "Psalms", chapters: "Psalms 73; 88; 1 Kings 11:41-43; 2 Chronicles 9:29-31; 1 Kings 14:21; 2 Chronicles 12:13, 14", diamond: false, dot: false },
      { day: 175, book: "1 Kings", chapters: "1 Kings 12:1-19; 2 Chronicles 10; 1 Kings 12:20-24; 2 Chronicles 11:1-4; 1 Kings 12:25-31; 2 Chronicles 11:13-17; 1 Kings 12:32-13:34", diamond: false, dot: false },
      { day: 176, book: "1 Kings", chapters: "1 Kings 14:1-18; 2 Chronicles 11:5-12; 11:18-23; 1 Kings 14:22-28; 2 Chronicles 12:1-12; Psalms 89", diamond: false, dot: false },
      { day: 177, book: "1 Kings", chapters: "1 Kings 14:29-31; 2 Chronicles 12:15, 16; 1 Kings 15:1-8; 2 Chronicles 13; 1 Kings 15:9-14; 2 Chronicles 14, 15", diamond: false, dot: false },
      { day: 178, book: "2 Chronicles", chapters: "2 Chronicles 16:1-6; 1 Kings 15:17-22; 2 Chronicles 16:7-17:19; 1 Kings 14:19, 20; 15:25-32", diamond: false, dot: false },
      { day: 179, book: "1 Kings", chapters: "1 Kings 15:33-16:28; 2 Kings 14:21, 22; 15:1-5; 2 Chronicles 26:1-21; Amos 1", diamond: false, dot: false },
      { day: 180, book: "1 Kings", chapters: "1 Kings 21; 22:51-53; 22:1-35; 2 Chronicles 18:2-34", diamond: false, dot: false },
      { day: 181, book: "1 Kings", chapters: "1 Kings 22:36-40; 2 Kings 1:1; 2 Chronicles 19:1-20:30; Psalms 46-48", diamond: false, dot: false },
      { day: 182, book: "Psalms", chapters: "Psalms 49; 83; 91; 1 Kings 22:47-49; 2 Chronicles 20:35-37; 2 Kings 1:2-18; 3:1-3", diamond: false, dot: false },
      { day: 183, book: "2 Kings", chapters: "2 Kings 2; 3:4-27; 1 Kings 22:50; 2 Chronicles 21:1-3; 2 Kings 8:16-25; 2 Chronicles 21:4-20; 22:1-6; 2 Kings 8:26-29", diamond: false, dot: false },
      { day: 184, book: "2 Kings", chapters: "2 Kings 9; 2 Chronicles 22:7-9; 2 Kings 10:1-27; 11:1-3; 2 Chronicles 22:10-12", diamond: false, dot: false },
      { day: 185, book: "2 Kings", chapters: "2 Kings 10:28-36; 2 Chronicles 24:1-16; 2 Kings 12:1-16; 2 Chronicles 24:17-22", diamond: false, dot: false },
      { day: 186, book: "2 Kings", chapters: "2 Kings 11:4-21; 2 Chronicles 23; 2 Kings 12:17-21; 2 Chronicles 24:23-27", diamond: false, dot: false },
      { day: 187, book: "2 Kings", chapters: "2 Kings 13; 2 Chronicles 25:1-4; 2 Kings 14:1-14; 2 Chronicles 25:5-24", diamond: false, dot: false },
      { day: 188, book: "2 Kings", chapters: "2 Kings 14:21, 22; 15:1-5; 2 Chronicles 26:1-21; Amos 1", diamond: false, dot: false },
      { day: 189, book: "Amos", chapters: "Amos 2-5; Joel", diamond: false, dot: false },
      { day: 190, book: "Amos", chapters: "Amos 6-9; Hosea 1-3", diamond: false, dot: false },
      { day: 191, book: "Hosea", chapters: "Hosea 4, 5; 2 Kings 14:24-28; Jonah; 2 Kings 14:29; 15:8-16; Isaiah 1-4", diamond: false, dot: false },
      { day: 192, book: "2 Kings", chapters: "2 Kings 15:17-20; 1 Chronicles 5:23-26; 2 Kings 15:6, 7; 2 Chronicles 26:22, 23; 2 Kings 15:21-29; Isaiah 6; 2 Kings 15:32-38; 2 Chronicles 27; 1 Chronicles 5:11-17", diamond: false, dot: false },
      { day: 193, book: "Isaiah", chapters: "Isaiah 7-9; 2 Kings 16:1-9; 2 Chronicles 28:1-21", diamond: false, dot: false },
      { day: 194, book: "Micah", chapters: "Micah 1-3; 2 Kings 15:30; 17:1, 2; 2 Chronicles 28:22-27; Hosea 6-8", diamond: false, dot: false },
      { day: 195, book: "Hosea", chapters: "Hosea 9-14; Micah 4-7", diamond: false, dot: false },
      { day: 196, book: "2 Kings", chapters: "2 Kings 16:10-20; Isaiah 10-12", diamond: false, dot: false },
      { day: 197, book: "Isaiah", chapters: "Isaiah 13-17", diamond: false, dot: false },
      { day: 198, book: "Isaiah", chapters: "Isaiah 18-23", diamond: false, dot: false },
      { day: 199, book: "2 Kings", chapters: "2 Kings 17:3-23; 18:1-8; 2 Chronicles 29, 30", diamond: false, dot: false },
      { day: 200, book: "2 Chronicles", chapters: "2 Chronicles 31; 2 Kings 17:24-41; 18:9-12", diamond: false, dot: false },
      { day: 201, book: "2 Kings", chapters: "2 Kings 18:13-19:37; 2 Chronicles 32:1-23", diamond: false, dot: false },
      { day: 202, book: "Psalms", chapters: "Psalms 75-77", diamond: false, dot: false },
      { day: 203, book: "Psalms", chapters: "Psalms 87; 125; Isaiah 11", diamond: false, dot: false },
      { day: 204, book: "Isaiah", chapters: "Isaiah 10; 12; 28", diamond: false, dot: false },
      { day: 205, book: "Isaiah", chapters: "Isaiah 29-32", diamond: false, dot: false },
      { day: 206, book: "Isaiah", chapters: "Isaiah 33:1-37:13", diamond: false, dot: false },
      { day: 207, book: "Isaiah", chapters: "Isaiah 37:14-38:22; 2 Kings 20:1-11; 2 Chronicles 32:24-26; 2 Kings 20:12-19; 2 Chronicles 32:27-31; Isaiah 39", diamond: false, dot: false },
      { day: 208, book: "2 Kings", chapters: "2 Kings 20:20, 21; 2 Chronicles 32:32, 33; 2 Kings 21:1-17; 2 Chronicles 33:1-9; Psalms 82; 2 Chronicles 33:10-19; 2 Kings 21:18-26; 2 Chronicles 33:20-25; 2 Kings 22:1, 2; 2 Chronicles 34:1-3", diamond: false, dot: false },
      { day: 209, book: "Isaiah", chapters: "Isaiah 40-42", diamond: false, dot: false },
      { day: 210, book: "Isaiah", chapters: "Isaiah 43-46", diamond: false, dot: false },
      { day: 211, book: "Isaiah", chapters: "Isaiah 47-50", diamond: false, dot: false },
      { day: 212, book: "Isaiah", chapters: "Isaiah 51-55", diamond: false, dot: false },
      { day: 213, book: "Isaiah", chapters: "Isaiah 56-60", diamond: false, dot: false },
      { day: 214, book: "Isaiah", chapters: "Isaiah 61-65", diamond: false, dot: false },
      { day: 215, book: "Isaiah", chapters: "Isaiah 66", diamond: false, dot: false },
      { day: 216, book: "Zephaniah", chapters: "Zephaniah; 2 Chronicles 34:4-7", diamond: false, dot: false },
      { day: 217, book: "Jeremiah", chapters: "Jeremiah 1-3", diamond: false, dot: false },
      { day: 218, book: "Jeremiah", chapters: "Jeremiah 4-6", diamond: false, dot: false },
      { day: 219, book: "Jeremiah", chapters: "Jeremiah 7-9", diamond: false, dot: false },
      { day: 220, book: "Jeremiah", chapters: "Jeremiah 10-13", diamond: false, dot: false },
      { day: 221, book: "Jeremiah", chapters: "Jeremiah 14-17", diamond: false, dot: false },
      { day: 222, book: "Jeremiah", chapters: "Jeremiah 18-22", diamond: false, dot: false },
      { day: 223, book: "Jeremiah", chapters: "Jeremiah 23-25", diamond: false, dot: false },
      { day: 224, book: "Jeremiah", chapters: "Jeremiah 26; 35; 36; 45", diamond: false, dot: false },
      { day: 225, book: "Nahum", chapters: "Nahum; 2 Kings 22:3-20; 2 Chronicles 34:8-28", diamond: false, dot: false },
      { day: 226, book: "2 Kings", chapters: "2 Kings 23:1-28; 2 Chronicles 34:29-35:19", diamond: false, dot: false },
      { day: 227, book: "Habakkuk", chapters: "Habakkuk; 2 Chronicles 35:20-27; 2 Kings 23:29-37; 2 Chronicles 36:1-5", diamond: false, dot: false },
      { day: 228, book: "Jeremiah", chapters: "Jeremiah 22:10-17; 46-48", diamond: false, dot: false },
      { day: 229, book: "Jeremiah", chapters: "Jeremiah 49, 50", diamond: false, dot: false },
      { day: 230, book: "Jeremiah", chapters: "Jeremiah 51; 2 Kings 24:1-4; 2 Chronicles 36:6, 7", diamond: false, dot: false },
      { day: 231, book: "Daniel", chapters: "Daniel 1; Jeremiah 27; 28; 24", diamond: false, dot: false },
      { day: 232, book: "Jeremiah", chapters: "Jeremiah 29-31", diamond: false, dot: false },
      { day: 233, book: "Ezekiel", chapters: "Ezekiel 1-4", diamond: false, dot: false },
      { day: 234, book: "Ezekiel", chapters: "Ezekiel 5-9", diamond: false, dot: false },
      { day: 235, book: "Ezekiel", chapters: "Ezekiel 10-13", diamond: false, dot: false },
      { day: 236, book: "Ezekiel", chapters: "Ezekiel 14-16", diamond: false, dot: false },
      { day: 237, book: "Ezekiel", chapters: "Ezekiel 17:1-20:29", diamond: false, dot: false },
      { day: 238, book: "Ezekiel", chapters: "Ezekiel 20:30-22:31", diamond: false, dot: false },
      { day: 239, book: "Ezekiel", chapters: "Ezekiel 23; Jeremiah 21; Ezekiel 24", diamond: false, dot: false },
      { day: 240, book: "Ezekiel", chapters: "Ezekiel 25; Jeremiah 37, 38; Ezekiel 29:1-16; 30:20-26", diamond: false, dot: false },
      { day: 241, book: "Ezekiel", chapters: "Ezekiel 31; Jeremiah 32, 33; Jeremiah 34", diamond: false, dot: false },
      { day: 242, book: "2 Kings", chapters: "2 Kings 25:1-21; 2 Chronicles 36:15-21; Jeremiah 39", diamond: false, dot: false },
      { day: 243, book: "Jeremiah", chapters: "Jeremiah 40-42; Obadiah", diamond: false, dot: false },
      { day: 244, book: "Jeremiah", chapters: "Jeremiah 43, 44; Lamentations 1, 2", diamond: false, dot: false },
      { day: 245, book: "Lamentations", chapters: "Lamentations 3-5; 2 Kings 25:22-26", diamond: false, dot: false },
      { day: 246, book: "Ezekiel", chapters: "Ezekiel 26-28", diamond: false, dot: false },
      { day: 247, book: "Ezekiel", chapters: "Ezekiel 29:17-30:19", diamond: false, dot: false },
      { day: 248, book: "Ezekiel", chapters: "Ezekiel 32; 33:21-33", diamond: false, dot: false },
      { day: 249, book: "Ezekiel", chapters: "Ezekiel 34-36", diamond: false, dot: false },
      { day: 250, book: "Ezekiel", chapters: "Ezekiel 37, 38", diamond: false, dot: false },
      { day: 251, book: "Ezekiel", chapters: "Ezekiel 39-41", diamond: false, dot: false },
      { day: 252, book: "Ezekiel", chapters: "Ezekiel 42-44", diamond: false, dot: false },
      { day: 253, book: "Ezekiel", chapters: "Ezekiel 45-48", diamond: false, dot: false },
      { day: 254, book: "Daniel", chapters: "Daniel 2, 3", diamond: false, dot: false },
      { day: 255, book: "Daniel", chapters: "Daniel 4-6", diamond: false, dot: false },
      { day: 256, book: "Daniel", chapters: "Daniel 7-9", diamond: false, dot: false },
      { day: 257, book: "Daniel", chapters: "Daniel 10-12", diamond: false, dot: false },
      { day: 258, book: "2 Kings", chapters: "2 Kings 25:27-30; Psalms 44; 74; 80; 102", diamond: false, dot: false },
      { day: 259, book: "Psalms", chapters: "Psalms 79; 85; 106; 137", diamond: false, dot: false },
      { day: 260, book: "Ezra", chapters: "Ezra 1, 2", diamond: false, dot: false },
      { day: 261, book: "Ezra", chapters: "Ezra 3; Psalms 92; 126", diamond: false, dot: false },
      { day: 262, book: "Ezra", chapters: "Ezra 4; Haggai", diamond: false, dot: false },
      { day: 263, book: "Zechariah", chapters: "Zechariah 1-4", diamond: false, dot: false },
      { day: 264, book: "Zechariah", chapters: "Zechariah 5-9", diamond: false, dot: false },
      { day: 265, book: "Zechariah", chapters: "Zechariah 10-14", diamond: false, dot: false },
      { day: 266, book: "Ezra", chapters: "Ezra 5, 6; Psalms 118; 138", diamond: false, dot: false },
      { day: 267, book: "Psalms", chapters: "Psalms 145; 148-150", diamond: false, dot: false },
      { day: 268, book: "Psalms", chapters: "Psalms 93; 95-97; 99", diamond: false, dot: false },
      { day: 269, book: "Esther", chapters: "Esther 1-4", diamond: false, dot: false },
      { day: 270, book: "Esther", chapters: "Esther 5-10", diamond: false, dot: false },
      { day: 271, book: "Ezra", chapters: "Ezra 7-10", diamond: false, dot: false },
      { day: 272, book: "Nehemiah", chapters: "Nehemiah 1-4", diamond: false, dot: false },
      { day: 273, book: "Nehemiah", chapters: "Nehemiah 5:1-7:3; Psalms 107", diamond: false, dot: false },
      { day: 274, book: "Psalms", chapters: "Psalms 111, 112; 117; 119:1-72", diamond: false, dot: false },
      { day: 275, book: "Psalms", chapters: "Psalms 119:73-176", diamond: false, dot: false },
      { day: 276, book: "Psalms", chapters: "Psalms 121; 123; 128; 130; 135, 136", diamond: false, dot: false },
      { day: 277, book: "Nehemiah", chapters: "Nehemiah 8, 9; Psalms 146", diamond: false, dot: false },
      { day: 278, book: "Nehemiah", chapters: "Nehemiah 10, 11; Psalms 147", diamond: false, dot: false },
      { day: 279, book: "1 Chronicles", chapters: "1 Chronicles 9:1-34; Nehemiah 12; Psalms 98; 134", diamond: false, dot: false },
      { day: 280, book: "Nehemiah", chapters: "Nehemiah 13; Psalms 50", diamond: false, dot: false },
      { day: 281, book: "Malachi", chapters: "Malachi", diamond: false, dot: false },
      { day: 282, book: "Luke", chapters: "Luke 1", diamond: false, dot: false },
      { day: 283, book: "Matthew", chapters: "Matthew 1:18-25; Luke 2:1-20; Matthew 1:1-17; Luke 3:23-38; 2:21-40", diamond: false, dot: false },
      { day: 284, book: "Matthew", chapters: "Matthew 2; Luke 2:41-52; Mark 1:1-8; Matthew 3:1-12; Luke 3:1-20; John 1:1-18", diamond: false, dot: false },
      { day: 285, book: "John", chapters: "John 1:19-28; Mark 1:9-11; Matthew 3:13-17; Luke 3:21, 22; John 1:29-34; Mark 1:12, 13; Matthew 4:1-11; Luke 4:1-13; John 1:35-51; Mark 1:16-20; Matthew 4:18-22", diamond: false, dot: false },
      { day: 286, book: "John", chapters: "John 2; Mark 1:14, 15; Matthew 4:12-17; Luke 4:14, 15; John 3:1-21", diamond: false, dot: false },
      { day: 287, book: "John", chapters: "John 3:22-4:45; Mark 1:14; Matthew 4:12; Luke 4:14", diamond: false, dot: false },
      { day: 288, book: "Mark", chapters: "Mark 1:16-39; Matthew 4:13-25; Luke 4:16-44; 5:1-16", diamond: false, dot: false },
      { day: 289, book: "Mark", chapters: "Mark 1:40-2:22; Matthew 8:1-4; 9:1-17; Luke 5:12-39", diamond: false, dot: false },
      { day: 290, book: "John", chapters: "John 5; Mark 2:23-3:12; Matthew 12:1-21; Luke 6:1-11", diamond: false, dot: false },
      { day: 291, book: "Mark", chapters: "Mark 3:13-19; Matthew 10:1-4; Luke 6:12-16; Matthew 5", diamond: false, dot: false },
      { day: 292, book: "Matthew", chapters: "Matthew 6, 7; Luke 6:17-49", diamond: false, dot: false },
      { day: 293, book: "Mark", chapters: "Mark 3:20-35; Matthew 12:22-50; Luke 8:1-21; 11:14-36", diamond: false, dot: false },
      { day: 294, book: "Mark", chapters: "Mark 4:1-34; Matthew 13:1-53; Luke 8:4-18", diamond: false, dot: false },
      { day: 295, book: "Mark", chapters: "Mark 4:35-5:43; Matthew 8:18-34; 9:18-34; Luke 8:22-56", diamond: false, dot: false },
      { day: 296, book: "Mark", chapters: "Mark 6:1-30; Matthew 9:35-11:1; 13:54-58; 14:1-12; Luke 9:1-10", diamond: false, dot: false },
      { day: 297, book: "Mark", chapters: "Mark 6:31-56; Matthew 14:13-36; Luke 9:10-17; John 6:1-24", diamond: false, dot: false },
      { day: 298, book: "John", chapters: "John 6:25-71; Mark 7:1-23; Matthew 15:1-20", diamond: false, dot: false },
      { day: 299, book: "Mark", chapters: "Mark 7:24-8:10; Matthew 15:21-39", diamond: false, dot: false },
      { day: 300, book: "Mark", chapters: "Mark 8:11-9:1; Matthew 15:39-16:28; Luke 9:18-27", diamond: false, dot: false },
      { day: 301, book: "Mark", chapters: "Mark 9:2-50; Matthew 17; Luke 9:28-50", diamond: false, dot: false },
      { day: 302, book: "Matthew", chapters: "Matthew 18; Mark 9:33-50; Luke 9:46-56; John 7:1-52", diamond: false, dot: false },
      { day: 303, book: "John", chapters: "John 7:53-9:41", diamond: false, dot: false },
      { day: 304, book: "John", chapters: "John 10; Luke 10:1-11:13", diamond: false, dot: false },
      { day: 305, book: "Luke", chapters: "Luke 11:37-13:21", diamond: false, dot: false },
      { day: 306, book: "Luke", chapters: "Luke 13:22-15:32", diamond: false, dot: false },
      { day: 307, book: "Luke", chapters: "Luke 16:1-17:10; John 11:1-54", diamond: false, dot: false },
      { day: 308, book: "Luke", chapters: "Luke 17:11-18:34; Mark 10:1-34; Matthew 19:1-20:28", diamond: false, dot: false },
      { day: 309, book: "Mark", chapters: "Mark 10:35-52; Matthew 20:20-34; Luke 18:35-19:28; John 11:55-12:11", diamond: false, dot: false },
      { day: 310, book: "Mark", chapters: "Mark 11:1-26; Matthew 21:1-22; Luke 19:29-48; John 12:12-36", diamond: false, dot: false },
      { day: 311, book: "Mark", chapters: "Mark 11:27-12:44; Matthew 21:23-23:39; Luke 20:1-21:4", diamond: false, dot: false },
      { day: 312, book: "Mark", chapters: "Mark 13; Matthew 24; Luke 21:5-38", diamond: false, dot: false },
      { day: 313, book: "Matthew", chapters: "Matthew 25; John 12:37-50", diamond: false, dot: false },
      { day: 314, book: "Mark", chapters: "Mark 14:1-31; Matthew 26:1-35; Luke 22:1-38; John 13", diamond: false, dot: false },
      { day: 315, book: "John", chapters: "John 14-16", diamond: false, dot: false },
      { day: 316, book: "John", chapters: "John 17; Mark 14:32-72; Matthew 26:36-75; Luke 22:39-71", diamond: false, dot: false },
      { day: 317, book: "Mark", chapters: "Mark 15:1-41; Matthew 27:1-56; Luke 23:1-49; John 18:1-19:37", diamond: false, dot: false },
      { day: 318, book: "Mark", chapters: "Mark 15:42-16:20; Matthew 27:57-28:20; Luke 23:50-24:53; John 19:38-21:25", diamond: false, dot: false },
      { day: 319, book: "Acts", chapters: "Acts 1, 2", diamond: false, dot: false },
      { day: 320, book: "Acts", chapters: "Acts 3-5", diamond: false, dot: false },
      { day: 321, book: "Acts", chapters: "Acts 6:1-8:3", diamond: false, dot: false },
      { day: 322, book: "Acts", chapters: "Acts 8:4-9:43", diamond: false, dot: false },
      { day: 323, book: "Acts", chapters: "Acts 10-12", diamond: false, dot: false },
      { day: 324, book: "Acts", chapters: "Acts 13, 14", diamond: false, dot: false },
      { day: 325, book: "James", chapters: "James 1-5", diamond: false, dot: false },
      { day: 326, book: "Acts", chapters: "Acts 15:1-35; Galatians 1, 2", diamond: false, dot: false },
      { day: 327, book: "Galatians", chapters: "Galatians 3-6", diamond: false, dot: false },
      { day: 328, book: "Acts", chapters: "Acts 15:36-17:34", diamond: false, dot: false },
      { day: 329, book: "1 Thessalonians", chapters: "1 Thessalonians 1-5; 2 Thessalonians 1-3", diamond: false, dot: false },
      { day: 330, book: "Acts", chapters: "Acts 18:1-19:20", diamond: false, dot: false },
      { day: 331, book: "1 Corinthians", chapters: "1 Corinthians 1-4", diamond: false, dot: false },
      { day: 332, book: "1 Corinthians", chapters: "1 Corinthians 5-8", diamond: false, dot: false },
      { day: 333, book: "1 Corinthians", chapters: "1 Corinthians 9-11", diamond: false, dot: false },
      { day: 334, book: "1 Corinthians", chapters: "1 Corinthians 12-14", diamond: false, dot: false },
      { day: 335, book: "1 Corinthians", chapters: "1 Corinthians 15, 16", diamond: false, dot: false },
      { day: 336, book: "2 Corinthians", chapters: "2 Corinthians 1-4", diamond: false, dot: false },
      { day: 337, book: "2 Corinthians", chapters: "2 Corinthians 5-9", diamond: false, dot: false },
      { day: 338, book: "2 Corinthians", chapters: "2 Corinthians 10-13", diamond: false, dot: false },
      { day: 339, book: "Acts", chapters: "Acts 19:21-20:6; Romans 1-3", diamond: false, dot: false },
      { day: 340, book: "Romans", chapters: "Romans 4-7", diamond: false, dot: false },
      { day: 341, book: "Romans", chapters: "Romans 8-10", diamond: false, dot: false },
      { day: 342, book: "Romans", chapters: "Romans 11-14", diamond: false, dot: false },
      { day: 343, book: "Romans", chapters: "Romans 15, 16; Acts 20:7-38", diamond: false, dot: false },
      { day: 344, book: "Acts", chapters: "Acts 21:1-23:11", diamond: false, dot: false },
      { day: 345, book: "Acts", chapters: "Acts 23:12-25:22", diamond: false, dot: false },
      { day: 346, book: "Acts", chapters: "Acts 25:23-28:10", diamond: false, dot: false },
      { day: 347, book: "Acts", chapters: "Acts 28:11-31; Ephesians 1-3", diamond: false, dot: false },
      { day: 348, book: "Ephesians", chapters: "Ephesians 4-6", diamond: false, dot: false },
      { day: 349, book: "Colossians", chapters: "Colossians 1-4; Philemon", diamond: false, dot: false },
      { day: 350, book: "Philippians", chapters: "Philippians 1-4", diamond: false, dot: false },
      { day: 351, book: "1 Timothy", chapters: "1 Timothy 1-6", diamond: false, dot: false },
      { day: 352, book: "Titus", chapters: "Titus 1-3; 2 Timothy 1-4", diamond: false, dot: false },
      { day: 353, book: "1 Peter", chapters: "1 Peter 1-5", diamond: false, dot: false },
      { day: 354, book: "Hebrews", chapters: "Hebrews 1-4", diamond: false, dot: false },
      { day: 355, book: "Hebrews", chapters: "Hebrews 5-7", diamond: false, dot: false },
      { day: 356, book: "Hebrews", chapters: "Hebrews 8-10", diamond: false, dot: false },
      { day: 357, book: "Hebrews", chapters: "Hebrews 11-13", diamond: false, dot: false },
      { day: 358, book: "2 Peter", chapters: "2 Peter 1-3; Jude", diamond: false, dot: false },
      { day: 359, book: "1 John", chapters: "1 John 1-5", diamond: false, dot: false },
      { day: 360, book: "2 John", chapters: "2 John; 3 John; Revelation 1-3", diamond: false, dot: false },
      { day: 361, book: "Revelation", chapters: "Revelation 4-8", diamond: false, dot: false },
      { day: 362, book: "Revelation", chapters: "Revelation 9-12", diamond: false, dot: false },
      { day: 363, book: "Revelation", chapters: "Revelation 13-16", diamond: false, dot: false },
      { day: 364, book: "Revelation", chapters: "Revelation 17-19", diamond: false, dot: false },
      { day: 365, book: "Revelation", chapters: "Revelation 20-22", diamond: false, dot: false }
    ];

    // Active plan state
    let currentPlan = '1year';
    let currentOrder = 'bible';
    let activeReadings = READINGS_1YEAR;
    let activeBooksInOrder = [...new Set(READINGS_1YEAR.map(r => r.book))];

    // State
    let completed = {};
    let expandedBook = null;

    function getStorageKeyForPlan(plan, order) {
      var p = plan || currentPlan;
      var o = order !== undefined ? order : currentOrder;
      return 'bible-reading-progress-' + p + '-' + o;
    }

    function isFreestyleType() {
      return currentPlan === 'freestyle' && currentOrder === 'bible';
    }

    function isChronoFreestyle() {
      return currentPlan === 'freestyle' && currentOrder === 'chrono';
    }

    function isUnscheduled() {
      return currentPlan === 'freestyle';
    }

    function initPlan() {
      // Migrate old dealers data to freestyle
      if (currentPlan === 'dealers') {
        var oldDealersData = localStorage.getItem('bible-reading-progress-dealers');
        if (oldDealersData) {
          var existingFreestyle = localStorage.getItem(getStorageKeyForPlan('freestyle', 'bible'));
          if (!existingFreestyle) {
            localStorage.setItem(getStorageKeyForPlan('freestyle', 'bible'), oldDealersData);
          }
        }
        currentPlan = 'freestyle';
        currentOrder = 'bible';
        localStorage.setItem('bible-reading-plan-selection', JSON.stringify({ plan: 'freestyle', order: 'bible' }));
      }

      if (currentPlan === 'freestyle' && currentOrder === 'bible') {
        // Bible-order freestyle: chapter cards, random button
        activeReadings = [];
        activeBooksInOrder = BIBLE_BOOKS.map(function(b) { return b[0]; });
      } else if (currentPlan === 'freestyle' && currentOrder === 'chrono') {
        // Chrono freestyle: chrono readings as checklist, no dates
        activeReadings = READINGS_CHRONO;
        activeBooksInOrder = [...new Set(READINGS_CHRONO.map(r => r.book))];
      } else if (currentOrder === 'chrono') {
        // Scheduled chrono (only 1year supported)
        activeReadings = READINGS_CHRONO;
        activeBooksInOrder = [...new Set(READINGS_CHRONO.map(r => r.book))];
      } else {
        // Scheduled bible order
        if (currentPlan === '1year') {
          activeReadings = READINGS_1YEAR;
          activeBooksInOrder = [...new Set(READINGS_1YEAR.map(r => r.book))];
        } else if (currentPlan === '2year') {
          activeReadings = generatePlan(730);
          activeBooksInOrder = [...new Set(activeReadings.map(r => r.book))];
        } else if (currentPlan === '3year') {
          activeReadings = generatePlan(1095);
          activeBooksInOrder = [...new Set(activeReadings.map(r => r.book))];
        }
      }
    }

    function getReadingKey(reading) {
      return reading.day;
    }

    // Load saved data
    function loadData() {
      try {
        // Load plan selection
        var planSaved = localStorage.getItem('bible-reading-plan-selection');
        if (planSaved) {
          var planData = JSON.parse(planSaved);

          // Migrate old chrono plan to 1year + chrono order
          if (planData.plan === 'chrono') {
            planData.plan = '1year';
            planData.order = 'chrono';
            // Migrate progress key
            var oldProgress = localStorage.getItem('bible-reading-progress-chrono');
            if (oldProgress) {
              var newKey = 'bible-reading-progress-1year-chrono';
              if (!localStorage.getItem(newKey)) {
                localStorage.setItem(newKey, oldProgress);
              }
            }
            // Migrate start date key
            var oldStart = localStorage.getItem('bible-reading-start-date-chrono');
            if (oldStart) {
              var newStartKey = 'bible-reading-start-date-1year-chrono';
              if (!localStorage.getItem(newStartKey)) {
                localStorage.setItem(newStartKey, oldStart);
              }
            }
            localStorage.setItem('bible-reading-plan-selection', JSON.stringify(planData));
          }

          // v2.0.3 migration: chrono data was renumbered, reset chrono progress
          var chronoMigrated = localStorage.getItem('chrono-v203-migrated');
          if (!chronoMigrated && planData.order === 'chrono') {
            var chronoKey = 'bible-reading-progress-' + planData.plan + '-chrono';
            var existingProgress = localStorage.getItem(chronoKey);
            if (existingProgress) {
              var progressData = JSON.parse(existingProgress);
              var count = Object.keys(progressData).length;
              if (count > 0) {
                alert('The chronological reading schedule has been improved in this update. Your chrono progress (' + count + ' readings) has been reset because the day numbers changed. Bible order progress is unaffected.');
              }
              localStorage.removeItem(chronoKey);
            }
            localStorage.setItem('chrono-v203-migrated', '1');
          }

          if (planData.plan && PLAN_TYPES[planData.plan]) {
            currentPlan = planData.plan;
          }
          currentOrder = planData.order || 'bible';
        } else {
          // Check for old data migration
          var oldData = localStorage.getItem(STORAGE_KEY);
          if (oldData) {
            // Migrate old data to 1year plan
            localStorage.setItem(getStorageKeyForPlan('1year', 'bible'), oldData);
            localStorage.setItem('bible-reading-plan-selection', JSON.stringify({ plan: '1year', order: 'bible' }));
            currentPlan = '1year';
            currentOrder = 'bible';
          } else {
            // No plan selected and no old data ‚Üí first launch
            currentPlan = null;
            return;
          }
        }
        initPlan();
        // Load progress: try new key format, fall back to old key without order suffix
        var saved = localStorage.getItem(getStorageKeyForPlan(currentPlan, currentOrder));
        if (!saved) {
          saved = localStorage.getItem('bible-reading-progress-' + currentPlan);
          if (saved) {
            // Migrate to new key format
            localStorage.setItem(getStorageKeyForPlan(currentPlan, currentOrder), saved);
          }
        }
        if (saved) completed = JSON.parse(saved);
      } catch(e) {}
    }

    function saveData() {
      localStorage.setItem(getStorageKeyForPlan(currentPlan), JSON.stringify(completed));
    }

    // Helpers
    function getDateFromDay(day) {
      const date = new Date(getStartDate());
      date.setDate(date.getDate() + day - 1);
      return date;
    }

    function formatDate(date) {
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      return months[date.getMonth()] + ' ' + date.getDate();
    }

    function getBibleCode(reading) {
      const bookNum = BOOK_NUM[reading.book];
      if (!bookNum) return null;
      const chapterMatch = reading.chapters ? reading.chapters.match(/^(\d+)/) : null;
      const chapter = chapterMatch ? chapterMatch[1] : '1';
      return String(bookNum).padStart(2, '0') + String(chapter).padStart(3, '0') + '001';
    }

    function getJWLibraryUrl(reading) {
      const code = getBibleCode(reading);
      if (!code) return 'https://www.jw.org/en/library/bible/study-bible/books/';
      return 'https://www.jw.org/finder?srcid=jwlshare&wtlocale=E&prefer=lang&bible=' + code + '&pub=nwtsty';
    }

    window.openReading = function(readingIndex) {
      var reading = activeReadings[readingIndex];
      if (!reading) return;
      var code = getBibleCode(reading);
      if (code && isNative()) {
        var appUrl = 'https://www.jw.org/finder?srcid=jwlshare&wtlocale=E&prefer=lang&bible=' + code + '&pub=nwtsty';
        window.location.href = appUrl;
      } else {
        openExternal(getJWLibraryUrl(reading));
      }
    };

    window.openFreestyleChapter = function(book, chapter, verse) {
      var bookNum = BOOK_NUM[book];
      if (!bookNum) return;
      var v = verse || 1;
      var code = String(bookNum).padStart(2, '0') + String(chapter).padStart(3, '0') + String(v).padStart(3, '0');
      var url = 'https://www.jw.org/finder?srcid=jwlshare&wtlocale=E&prefer=lang&bible=' + code + '&pub=nwtsty';
      if (isNative()) {
        window.location.href = url;
      } else {
        openExternal(url);
      }
    };

    // Build sorted list of book names from BOOK_NUM, longest first for greedy matching
    var BOOK_NAMES_SORTED = Object.keys(BOOK_NUM).sort(function(a, b) { return b.length - a.length; });

    function parseChronoSegments(chaptersText) {
      if (!chaptersText) return [];
      var parts = chaptersText.split('; ');
      var segments = [];
      var lastBook = null;

      for (var i = 0; i < parts.length; i++) {
        var part = parts[i].trim();
        if (!part) continue;

        // Try to match a known book name at the start
        var foundBook = null;
        for (var j = 0; j < BOOK_NAMES_SORTED.length; j++) {
          var name = BOOK_NAMES_SORTED[j];
          if (part.indexOf(name) === 0 && (part.length === name.length || part[name.length] === ' ')) {
            foundBook = name;
            break;
          }
        }

        if (foundBook) {
          // Extract first chapter number from the rest after the book name
          var rest = part.substring(foundBook.length).trim();
          var chMatch = rest.match(/(\d+)(?::(\d+))?/);
          var ch = chMatch ? parseInt(chMatch[1], 10) : 1;
          var v = chMatch && chMatch[2] ? parseInt(chMatch[2], 10) : 1;
          segments.push({ book: foundBook, label: part, chapter: ch, verse: v });
          lastBook = foundBook;
        } else if (lastBook) {
          // Bare reference like "25:12-18" ‚Äî belongs to the previous book
          // Create separate segment (non-contiguous within same book)
          var chMatch2 = part.match(/(\d+)(?::(\d+))?/);
          var ch2 = chMatch2 ? parseInt(chMatch2[1], 10) : 1;
          var v2 = chMatch2 && chMatch2[2] ? parseInt(chMatch2[2], 10) : 1;
          segments.push({ book: lastBook, label: lastBook + ' ' + part, chapter: ch2, verse: v2 });
        }
      }

      return segments;
    }

    function getBookStats(book) {
      if (isFreestyleType()) {
        var bookInfo = BIBLE_BOOKS.find(function(b) { return b[0] === book; });
        if (!bookInfo) return { total: 0, done: 0, isComplete: false, hasStarted: false };
        var total = bookInfo[1];
        var done = 0;
        for (var c = 1; c <= total; c++) {
          if (completed[book + '-' + c]) done++;
        }
        return { total: total, done: done, isComplete: done === total, hasStarted: done > 0 };
      }
      // For chrono freestyle and scheduled plans, use activeReadings
      var readings;
      if (currentOrder === 'chrono') {
        readings = activeReadings.filter(function(r) { return r.book === book || r.chapters.indexOf(book) !== -1; });
      } else {
        readings = activeReadings.filter(function(r) { return r.book === book; });
      }
      var done = readings.filter(function(r) { return !!completed[r.day]; }).length;
      return { total: readings.length, done: done, isComplete: done === readings.length, hasStarted: done > 0 };
    }

    function getStats() {
      if (isFreestyleType()) {
        var completedCount = Object.keys(completed).length;
        return {
          completedCount: completedCount,
          remaining: TOTAL_CHAPTERS - completedCount,
          behind: 0,
          shouldBeAt: 0,
          percent: Math.round((completedCount / TOTAL_CHAPTERS) * 100),
          total: TOTAL_CHAPTERS
        };
      }
      if (isChronoFreestyle()) {
        var completedCount = Object.keys(completed).length;
        var total = activeReadings.length;
        return {
          completedCount: completedCount,
          remaining: total - completedCount,
          behind: 0,
          shouldBeAt: 0,
          percent: Math.round((completedCount / total) * 100),
          total: total
        };
      }
      const totalReadings = activeReadings.length;
      // Count unique days completed
      var completedCount = 0;
      var seenDays = {};
      for (var key in completed) {
        if (!seenDays[key]) {
          seenDays[key] = true;
          completedCount++;
        }
      }
      const now = new Date();
      const startDate = getStartDate();
      const dayOfYear = Math.floor((now - startDate) / (1000 * 60 * 60 * 24)) + 1;
      var planDays = getPlanDays(currentPlan, currentOrder);
      const shouldBeAt = Math.min(Math.max(dayOfYear, 0), planDays);
      // Count how many readings should be done by now (readings with day <= shouldBeAt)
      var shouldHaveDone = activeReadings.filter(function(r) { return r.day <= shouldBeAt; }).length;
      const behind = Math.max(0, shouldHaveDone - completedCount);
      const ahead = Math.max(0, completedCount - shouldHaveDone);
      return {
        completedCount: completedCount,
        remaining: totalReadings - completedCount,
        behind: behind,
        ahead: ahead,
        shouldBeAt: shouldBeAt,
        percent: Math.round((completedCount / totalReadings) * 100),
        total: totalReadings,
        planDays: planDays,
        shouldHaveDone: shouldHaveDone
      };
    }

    window.toggleComplete = function(key) {
      if (completed[key]) {
        delete completed[key];
      } else {
        completed[key] = new Date().toISOString();
      }
      saveData();
      render();
    };

    // Render functions
    function render() {
      if (!currentPlan) return; // no plan selected yet
      const stats = getStats();
      var unscheduled = isUnscheduled();

      // Plan subtitle
      var subtitleParts = PLAN_TYPES[currentPlan].label;
      if (currentOrder === 'chrono') subtitleParts += ' (Chronological)';
      document.getElementById('planSubtitle').textContent = subtitleParts;

      // Progress
      document.getElementById('progressFill').style.width = stats.percent + '%';
      document.getElementById('progressText').textContent = stats.percent + '%';

      // Progress marker: hide for unscheduled (both freestyle variants)
      var marker = document.getElementById('progressMarker');
      if (unscheduled) {
        marker.style.display = 'none';
      } else {
        marker.style.display = '';
        var shouldPercent = Math.round((stats.shouldHaveDone / stats.total) * 100);
        marker.style.left = shouldPercent + '%';
      }

      document.getElementById('statDone').textContent = stats.completedCount;
      document.getElementById('statToGo').textContent = stats.remaining;

      // Behind/Ahead stat: hide for unscheduled (both freestyle variants)
      var behindEl = document.getElementById('statBehind');
      var behindLabel = document.getElementById('statBehindLabel');
      var behindParent = behindEl.parentElement;
      if (unscheduled) {
        behindParent.style.display = 'none';
      } else {
        behindParent.style.display = '';
        if (stats.ahead > 0) {
          behindEl.textContent = stats.ahead;
          behindEl.className = 'stat-value';
          behindEl.style.color = '#50C878';
          behindLabel.textContent = 'Ahead';
        } else {
          behindEl.textContent = stats.behind;
          behindEl.className = stats.behind > 0 ? 'stat-value behind' : 'stat-value';
          behindEl.style.color = '';
          behindLabel.textContent = 'Behind';
        }
      }

      // Bible grid
      const grid = document.getElementById('bibleGrid');
      grid.innerHTML = activeBooksInOrder.map(book => {
        const bookStats = getBookStats(book);
        const abbrev = BOOK_ABBREV[book] || book.substring(0, 3);
        let cls = 'book-box';
        if (bookStats.isComplete) cls += ' complete';
        else if (bookStats.hasStarted) cls += ' in-progress';
        if (expandedBook === book) cls += ' expanded';
        return '<div class="' + cls + '" onclick="toggleExpandBook(\'' + book.replace(/'/g, "\\'") + '\')">' + abbrev + '</div>';
      }).join('');

      // Spin button for bible-order freestyle only
      var existingSpinBtn = document.getElementById('spinBtn');
      if (isFreestyleType()) {
        if (!existingSpinBtn) {
          var spinBtn = document.createElement('button');
          spinBtn.id = 'spinBtn';
          spinBtn.className = 'spin-btn';
          spinBtn.textContent = 'Random Chapter';
          spinBtn.onclick = spinTheWheel;
          grid.parentNode.insertBefore(spinBtn, grid.nextSibling);
        } else {
          existingSpinBtn.style.display = '';
          existingSpinBtn.disabled = false;
        }
      } else if (existingSpinBtn) {
        existingSpinBtn.style.display = 'none';
      }

      // Expanded book
      renderExpandedBook();

      // Readings list
      renderReadings();
    }

    function renderExpandedBook() {
      const container = document.getElementById('expandedBook');
      if (!expandedBook) {
        container.classList.remove('show');
        return;
      }

      container.classList.add('show');
      document.getElementById('expandedTitle').textContent = expandedBook;

      if (isFreestyleType()) {
        // Show chapter cards ‚Äî tap to open, long-press or tap checkmark to toggle complete
        var bookInfo = BIBLE_BOOKS.find(function(b) { return b[0] === expandedBook; });
        if (!bookInfo) return;
        var html = '';
        var safeBook = expandedBook.replace(/'/g, "\\'");
        for (var c = 1; c <= bookInfo[1]; c++) {
          var key = expandedBook + '-' + c;
          var isDone = completed[key];
          html += '<div class="chapter-card ' + (isDone ? 'complete' : '') + '" ' +
            'onclick="toggleComplete(\'' + key.replace(/'/g, "\\'") + '\')">' +
            '<span class="ch-num">' + c + '</span>' +
            '<span class="ch-open" onclick="event.stopPropagation(); openFreestyleChapter(\'' + safeBook + '\', ' + c + ')">open</span>' +
          '</div>';
        }
        document.getElementById('expandedReadings').innerHTML = html;
      } else if (currentOrder === 'chrono') {
        // Chrono: show all day-readings that mention this book in their text
        var bookName = expandedBook;
        var readings = activeReadings.filter(function(r) {
          return r.book === bookName || r.chapters.indexOf(bookName) !== -1;
        });
        var chronoFS = isChronoFreestyle();
        document.getElementById('expandedReadings').innerHTML = readings.map(function(r) {
          var isDone = completed[r.day];
          var label = chronoFS ? 'Day ' + r.day : formatDate(getDateFromDay(r.day));
          // Find the segment matching this expanded book to get correct chapter for open link
          var segs = parseChronoSegments(r.chapters);
          var matchSeg = null;
          for (var si = 0; si < segs.length; si++) {
            if (segs[si].book === bookName) { matchSeg = segs[si]; break; }
          }
          var openLink = '';
          if (matchSeg) {
            var safeB = matchSeg.book.replace(/'/g, "\\'");
            openLink = '<span class=\"ch-open\" onclick=\"event.stopPropagation(); openFreestyleChapter(\'' + safeB + '\', ' + matchSeg.chapter + ', ' + (matchSeg.verse || 1) + ')\" style=\"font-size:0.4rem;color:#50C878;cursor:pointer;\">open</span>';
          }
          return '<div class=\"reading-box ' + (isDone ? 'complete' : '') + '\" onclick=\"toggleComplete(' + r.day + ')\" style=\"width:auto;min-width:48px;max-width:140px;height:auto;min-height:48px;\">' +
            '<span class=\"date\">' + label + '</span>' +
            '<span class=\"chapters\" style=\"font-size:0.4rem;word-break:break-word;\">' + (r.chapters || 'All') + '</span>' +
            openLink +
          '</div>';
        }).join('');
      } else {
        const readings = activeReadings.filter(r => r.book === expandedBook);
        document.getElementById('expandedReadings').innerHTML = readings.map(r => {
          const date = getDateFromDay(r.day);
          const isDone = completed[r.day];
          return '<div class=\"reading-box ' + (isDone ? 'complete' : '') + '\" onclick=\"toggleComplete(' + r.day + ')\">' +
            '<span class=\"date\">' + formatDate(date) + '</span>' +
            '<span class=\"chapters\">' + (r.chapters || 'All') + '</span>' +
          '</div>';
        }).join('');
      }
    }

    function renderReadings() {
      var upNextTitle = document.getElementById('upNextTitle');
      var section = document.getElementById('readingsSection');

      // Bible-order freestyle: hide Up Next entirely
      if (isFreestyleType()) {
        upNextTitle.style.display = 'none';
        section.innerHTML = '';
        return;
      }

      upNextTitle.style.display = '';
      const incomplete = activeReadings.filter(r => !completed[r.day]);
      const currentDay = incomplete.length > 0 ? incomplete[0].day : null;
      var chronoFS = isChronoFreestyle();

      upNextTitle.textContent = incomplete.length > 0 ? 'Up Next' : 'All Complete! üéâ';

      section.innerHTML = incomplete.slice(0, 15).map((r, idx) => {
        const isCurrent = r.day === currentDay;
        const readingIdx = activeReadings.indexOf(r);
        var altClass = (currentOrder === 'chrono' && idx % 2 === 1) ? ' alt' : '';

        if (chronoFS) {
          // Chrono freestyle: no dates, no behind, no indicators
          var segsFS = (currentOrder === 'chrono') ? parseChronoSegments(r.chapters) : [];
          var multiFS = segsFS.length > 1;
          var btnHtmlFS = '';
          if (multiFS) {
            btnHtmlFS = '<div class="reading-segments">';
            for (var si2 = 0; si2 < segsFS.length; si2++) {
              var seg = segsFS[si2];
              var safeB = seg.book.replace(/'/g, "\\'");
              btnHtmlFS += '<div class="segment-row">' +
                '<span class="segment-label">' + seg.label + '</span>' +
                '<button class="read-now-btn" onclick="event.stopPropagation(); openFreestyleChapter(\'' + safeB + '\', ' + seg.chapter + ', ' + seg.verse + ')">Read Now</button>' +
              '</div>';
            }
            btnHtmlFS += '</div>';
          } else if (segsFS.length === 1) {
            var segSingle = segsFS[0];
            var safeBs = segSingle.book.replace(/'/g, "\\'");
            btnHtmlFS = '<button class="read-now-btn" onclick="event.stopPropagation(); openFreestyleChapter(\'' + safeBs + '\', ' + segSingle.chapter + ', ' + segSingle.verse + ')">Read Now</button>';
          } else {
            btnHtmlFS = '<button class="read-now-btn" onclick="openReading(' + readingIdx + ')">Read Now</button>';
          }
          return '<div class="reading-item' + altClass + ' ' + (isCurrent ? 'current' : '') + '" id="reading-' + r.day + '">' +
            '<div class="checkbox" onclick="toggleComplete(' + r.day + ')"></div>' +
            '<div class="reading-content" onclick="toggleComplete(' + r.day + ')">' +
              '<div class="reading-header">' +
                (isCurrent ? '<span class="current-badge">Next</span>' : '') +
              '</div>' +
              '<div class="reading-title">' + (multiFS ? 'Day ' + r.day : r.book + ' ' + r.chapters) + '</div>' +
              (multiFS ? btnHtmlFS : '') +
            '</div>' +
            (multiFS ? '' : btnHtmlFS) +
          '</div>';
        }

        // Chrono scheduled or bible-order scheduled
        var segsSch = (currentOrder === 'chrono') ? parseChronoSegments(r.chapters) : [];
        var multiSch = segsSch.length > 1;
        var btnHtmlSch = '';
        if (multiSch) {
          btnHtmlSch = '<div class="reading-segments">';
          for (var si4 = 0; si4 < segsSch.length; si4++) {
            var segS = segsSch[si4];
            var safeBs = segS.book.replace(/'/g, "\\'");
            btnHtmlSch += '<div class="segment-row">' +
              '<span class="segment-label">' + segS.label + '</span>' +
              '<button class="read-now-btn" onclick="event.stopPropagation(); openFreestyleChapter(\'' + safeBs + '\', ' + segS.chapter + ', ' + segS.verse + ')">Read Now</button>' +
            '</div>';
          }
          btnHtmlSch += '</div>';
        } else if (segsSch.length === 1) {
          var segSch1 = segsSch[0];
          var safeB1 = segSch1.book.replace(/'/g, "\\'");
          btnHtmlSch = '<button class="read-now-btn" onclick="event.stopPropagation(); openFreestyleChapter(\'' + safeB1 + '\', ' + segSch1.chapter + ', ' + segSch1.verse + ')">Read Now</button>';
        } else {
          btnHtmlSch = '<button class="read-now-btn" onclick="openReading(' + readingIdx + ')">Read Now</button>';
        }
        const date = getDateFromDay(r.day);
        return '<div class="reading-item' + altClass + ' ' + (isCurrent ? 'current' : '') + '" id="reading-' + r.day + '">' +
          '<div class="checkbox" onclick="toggleComplete(' + r.day + ')"></div>' +
          '<div class="reading-content" onclick="toggleComplete(' + r.day + ')">' +
            '<div class="reading-header">' +
              '<span class="reading-date">' + formatDate(date) + '</span>' +
              (r.diamond ? '<span class="indicator diamond">‚óÜ</span>' : '') +
              (r.dot ? '<span class="indicator dot">‚óè</span>' : '') +
              (isCurrent ? '<span class="current-badge">Next</span>' : '') +
            '</div>' +
            '<div class="reading-title">' + (multiSch ? formatDate(date) : r.book + ' ' + r.chapters) + '</div>' +
            (multiSch ? btnHtmlSch : '') +
          '</div>' +
          (multiSch ? '' : btnHtmlSch) +
        '</div>';
      }).join('');

      if (incomplete.length > 15) {
        section.innerHTML += '<p class="more-text">+' + (incomplete.length - 15) + ' more...</p>';
      }
    }

    window.toggleExpandBook = function(book) {
      expandedBook = expandedBook === book ? null : book;
      render();
    };

    window.closeExpandedBook = function() {
      expandedBook = null;
      render();
    };

    window.scrollToCurrent = function() {
      if (isFreestyleType()) return; // bible-order freestyle has no Up Next
      const incomplete = activeReadings.filter(r => !completed[r.day]);
      if (incomplete.length > 0) {
        const el = document.getElementById('reading-' + incomplete[0].day);
        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    };

    // Plan picker (two-step: style then pace)
    var pendingPace = null;
    var pendingOrder = null;
    var pendingPlanType = null;

    window.showPlanPicker = function() {
      document.getElementById('settingsModal').classList.remove('show');
      document.getElementById('stylePickerClose').style.display = currentPlan ? '' : 'none';
      document.getElementById('stylePickerModal').classList.add('show');
    };
    window.hideStylePicker = function() {
      document.getElementById('stylePickerModal').classList.remove('show');
    };

    window.selectStyle = function(style) {
      pendingOrder = style;
      document.getElementById('stylePickerModal').classList.remove('show');
      // Show/hide 2yr/3yr options based on style
      var bibleOnlyOptions = document.querySelectorAll('.pace-bible-only');
      for (var i = 0; i < bibleOnlyOptions.length; i++) {
        bibleOnlyOptions[i].style.display = style === 'chrono' ? 'none' : '';
      }
      document.getElementById('pacePickerModal').classList.add('show');
    };

    window.backToStylePicker = function() {
      document.getElementById('pacePickerModal').classList.remove('show');
      document.getElementById('stylePickerModal').classList.add('show');
    };

    window.selectPace = function(pace) {
      document.getElementById('pacePickerModal').classList.remove('show');
      var order = pendingOrder || 'bible';
      pendingOrder = null;

      // Confirm if switching
      if (currentPlan && (currentPlan !== pace || currentOrder !== order)) {
        if (!confirm('Switching plans will change your active reading schedule. Your progress for each plan is saved separately. Continue?')) {
          return;
        }
      }

      // For freestyle, skip date picker
      if (pace === 'freestyle') {
        finalizePlanSelection(pace, order);
        return;
      }

      // Check if this plan+order already has a start date set
      var startDateKey = 'bible-reading-start-date-' + pace + '-' + order;
      var existingDate = localStorage.getItem(startDateKey);
      if (!existingDate) existingDate = localStorage.getItem('bible-reading-start-date-' + pace);

      if (!existingDate) {
        // Show date picker
        pendingPlanType = pace;
        pendingOrder = order;
        var today = new Date();
        var todayStr = today.getFullYear() + '-' + String(today.getMonth()+1).padStart(2,'0') + '-' + String(today.getDate()).padStart(2,'0');
        document.getElementById('startDateInput').value = todayStr;
        document.getElementById('startDateModal').classList.add('show');
        return;
      }

      finalizePlanSelection(pace, order);
    };

    function finalizePlanSelection(plan, order) {
      currentPlan = plan;
      currentOrder = order;
      localStorage.setItem('bible-reading-plan-selection', JSON.stringify({ plan: plan, order: order }));
      // Load progress for this plan+order (or start fresh)
      completed = {};
      try {
        var saved = localStorage.getItem(getStorageKeyForPlan(plan, order));
        if (!saved) saved = localStorage.getItem('bible-reading-progress-' + plan);
        if (saved) completed = JSON.parse(saved);
      } catch(e) {}
      initPlan();
      expandedBook = null;
      render();
      if (!isUnscheduled()) {
        setTimeout(scrollToCurrent, 300);
      }
    }

    window.confirmStartDate = function() {
      var dateVal = document.getElementById('startDateInput').value;
      if (!dateVal) {
        alert('Please select a date.');
        return;
      }
      document.getElementById('startDateModal').classList.remove('show');
      var type = pendingPlanType;
      var order = pendingOrder || 'bible';
      pendingPlanType = null;
      pendingOrder = null;
      localStorage.setItem('bible-reading-start-date-' + type + '-' + order, dateVal);
      finalizePlanSelection(type, order);
    };

    window.cancelStartDate = function() {
      document.getElementById('startDateModal').classList.remove('show');
      pendingPlanType = null;
      pendingOrder = null;
    };

    window.showChangeStartDate = function() {
      document.getElementById('settingsModal').classList.remove('show');
      pendingPlanType = currentPlan;
      pendingOrder = currentOrder;
      document.getElementById('startDateInput').value = getStartDateStr();
      document.getElementById('startDateModal').classList.add('show');
    };

    window.confirmStartOver = function() {
      if (!confirm('This will erase all progress for your current plan. This cannot be undone.')) return;
      completed = {};
      saveData();
      expandedBook = null;
      render();
      window.hideSettings();
    };

    // Modals
    window.showSettings = function() {
      document.getElementById('settingsVersion').textContent = 'Version ' + APP_VERSION;
      var planLabel = currentPlan ? PLAN_TYPES[currentPlan].label : '';
      if (planLabel && currentOrder === 'chrono') planLabel += ', Chronological';
      document.getElementById('changePlanBtn').textContent = 'Change Reading Plan' + (planLabel ? ' (' + planLabel + ')' : '');
      // Show/hide start date controls
      var startDateBtn = document.getElementById('changeStartDateBtn');
      var startDateDisplay = document.getElementById('currentStartDateDisplay');
      if (currentPlan && !isUnscheduled()) {
        startDateBtn.style.display = '';
        startDateDisplay.style.display = '';
        var sd = getStartDate();
        startDateDisplay.textContent = 'Start date: ' + formatDate(sd) + ' ' + sd.getFullYear();
      } else {
        startDateBtn.style.display = 'none';
        startDateDisplay.style.display = 'none';
      }
      document.getElementById('settingsModal').classList.add('show');
    };
    window.hideSettings = function() { document.getElementById('settingsModal').classList.remove('show'); };

    window.exportData = async function() {
      const data = JSON.stringify({ plan: currentPlan, order: currentOrder, completed, exportDate: new Date().toISOString() });
      var doneCount = Object.keys(completed).length;
      var planSlug = currentPlan + (currentOrder === 'chrono' ? '-chrono' : '');
      const filename = 'bible-backup-' + planSlug + '-' + doneCount + 'done-' + new Date().toISOString().split('T')[0] + '.json';

      if (isNative()) {
        try {
          var FS = window.Capacitor.Plugins.Filesystem;
          var SharePlugin = window.Capacitor.Plugins.Share;
          var result = await FS.writeFile({
            path: filename,
            data: data,
            directory: 'CACHE',
            encoding: 'utf8'
          });
          await SharePlugin.share({
            title: 'Bible Reading Backup',
            text: 'Bible Reading 2026 progress backup',
            url: result.uri,
            dialogTitle: 'Share your backup'
          });
          localStorage.setItem('lastBackupDate', new Date().toISOString());
          hideBackupReminder();
        } catch(e) {
          if (e.message && e.message.includes('cancel')) return; // user cancelled share sheet
          alert('Export failed: ' + e.message);
        }
      } else {
        var blob = new Blob([data], { type: 'application/json' });
        // Use Web Share API with file support (works on iOS Safari)
        if (navigator.canShare && navigator.canShare({ files: [new File([blob], filename, { type: 'application/json' })] })) {
          try {
            await navigator.share({
              title: 'Bible Reading Backup',
              files: [new File([blob], filename, { type: 'application/json' })]
            });
            localStorage.setItem('lastBackupDate', new Date().toISOString());
            hideBackupReminder();
          } catch(e) {
            if (e.name === 'AbortError') return; // user cancelled
            // Fall back to download
            var blobUrl = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = blobUrl;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(blobUrl);
            localStorage.setItem('lastBackupDate', new Date().toISOString());
            hideBackupReminder();
          }
        } else {
          var blobUrl = URL.createObjectURL(blob);
          var a = document.createElement('a');
          a.href = blobUrl;
          a.download = filename;
          a.click();
          URL.revokeObjectURL(blobUrl);
          localStorage.setItem('lastBackupDate', new Date().toISOString());
          hideBackupReminder();
        }
      }
    }

    function processImportData(jsonString) {
      try {
        var data = JSON.parse(jsonString);
        if (data.completed) {
          var importPlan = data.plan || '1year';
          var importOrder = data.order || 'bible';
          if (importPlan === 'chrono') {
            importPlan = '1year';
            importOrder = 'chrono';
          }
          if (importPlan !== currentPlan || importOrder !== currentOrder) {
            var label = PLAN_TYPES[importPlan] ? PLAN_TYPES[importPlan].label : importPlan;
            if (importOrder === 'chrono') label += ' (Chronological)';
            if (!confirm('This backup is from the "' + label + '" plan. Switch to it and restore?')) {
              return;
            }
            currentPlan = importPlan;
            currentOrder = importOrder;
            localStorage.setItem('bible-reading-plan-selection', JSON.stringify({ plan: importPlan, order: importOrder }));
            initPlan();
          }
          completed = data.completed;
          saveData();
          render();
          alert('Progress restored!');
          window.hideSettings();
        } else {
          alert('Invalid backup file: no progress data found');
        }
      } catch(err) {
        alert('Invalid backup file');
      }
    }

    window.importData = function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          processImportData(e.target.result);
        };
        reader.readAsText(file);
      }
    };

    window.importBackup = async function() {
      if (isNative() && window.Capacitor.Plugins.FilePicker) {
        try {
          var result = await window.Capacitor.Plugins.FilePicker.pickFiles({
            types: ['application/json'],
            limit: 1,
            readData: true
          });
          if (result && result.files && result.files.length > 0) {
            var file = result.files[0];
            var content;
            if (file.data) {
              // data is base64-encoded
              content = atob(file.data);
            } else if (file.path) {
              var FS = window.Capacitor.Plugins.Filesystem;
              var readResult = await FS.readFile({ path: file.path, encoding: 'utf8' });
              content = readResult.data;
            }
            if (content) {
              processImportData(content);
            }
          }
        } catch(e) {
          if (e.message && e.message.includes('cancel')) return;
          alert('Import failed: ' + e.message);
        }
      } else {
        // Web fallback: trigger hidden file input
        document.getElementById('importFileInput').click();
      }
    };

    // Backup reminder
    function checkBackupReminder() {
      var doneCount = Object.keys(completed).length;
      if (doneCount === 0) return;
      var lastBackup = localStorage.getItem('lastBackupDate');
      var showReminder = false;
      var daysSince = 0;
      if (!lastBackup) {
        showReminder = true;
      } else {
        var lastDate = new Date(lastBackup);
        daysSince = Math.floor((new Date() - lastDate) / (1000 * 60 * 60 * 24));
        if (daysSince > 30) showReminder = true;
      }
      if (showReminder) {
        var el = document.getElementById('backupReminder');
        var textEl = document.getElementById('backupReminderText');
        if (!lastBackup) {
          textEl.textContent = "You haven't backed up your progress yet.";
        } else {
          textEl.textContent = "You haven't backed up in " + daysSince + " days.";
        }
        el.style.display = '';
      }
    }

    window.dismissBackupReminder = function() {
      document.getElementById('backupReminder').style.display = 'none';
    };

    function hideBackupReminder() {
      document.getElementById('backupReminder').style.display = 'none';
    }

    // Dealer's Choice functions
    var dealerSelection = null;
    var spinRunning = false;

    function getUnreadChapters() {
      var unread = [];
      for (var i = 0; i < BIBLE_BOOKS.length; i++) {
        var bookName = BIBLE_BOOKS[i][0];
        var count = BIBLE_BOOKS[i][1];
        for (var c = 1; c <= count; c++) {
          var key = bookName + '-' + c;
          if (!completed[key]) {
            unread.push({ book: bookName, chapter: c, key: key });
          }
        }
      }
      return unread;
    }

    window.spinTheWheel = function() {
      if (spinRunning) return;
      var unread = getUnreadChapters();
      if (unread.length === 0) { alert('All chapters complete!'); return; }

      spinRunning = true;
      var spinBtn = document.getElementById('spinBtn');
      if (spinBtn) spinBtn.disabled = true;

      // Close expanded book during spin
      expandedBook = null;
      renderExpandedBook();

      // Pick the final result
      var finalPick = unread[Math.floor(Math.random() * unread.length)];
      dealerSelection = finalPick;

      // Get all book boxes
      var grid = document.getElementById('bibleGrid');
      var boxes = grid.querySelectorAll('.book-box');
      var bookNames = activeBooksInOrder;

      // Animation: fast start, decelerate, ~3s total then 0.8s hold
      var totalSteps = 18;
      var step = 0;
      var lastHighlighted = null;

      function animateStep() {
        // Clear previous highlight
        if (lastHighlighted !== null) {
          boxes[lastHighlighted].classList.remove('spin-highlight');
        }

        if (step >= totalSteps) {
          // Final: highlight the selected book
          var finalIdx = bookNames.indexOf(finalPick.book);
          if (finalIdx >= 0 && finalIdx < boxes.length) {
            boxes[finalIdx].classList.add('spin-selected');
            setTimeout(function() {
              boxes[finalIdx].classList.remove('spin-selected');
              spinRunning = false;
              showDealerResult();
            }, 800);
          } else {
            spinRunning = false;
            showDealerResult();
          }
          return;
        }

        // Pick a random box (last few steps gravitate toward final book)
        var idx;
        if (step >= totalSteps - 3) {
          var finalIdx = bookNames.indexOf(finalPick.book);
          var spread = totalSteps - step; // 3, 2, 1
          var offset = Math.floor(Math.random() * (spread * 2 + 1)) - spread;
          idx = Math.max(0, Math.min(boxes.length - 1, finalIdx + offset));
        } else {
          idx = Math.floor(Math.random() * boxes.length);
        }

        boxes[idx].classList.add('spin-highlight');
        lastHighlighted = idx;
        step++;

        // Fast start (40ms), exponential slowdown to ~400ms
        var t = step / totalSteps; // 0..1
        var delay = 40 + Math.round(400 * t * t * t);
        setTimeout(animateStep, delay);
      }

      animateStep();
    };

    function showDealerResult() {
      if (!dealerSelection) return;
      document.getElementById('dealerBook').textContent = dealerSelection.book;
      document.getElementById('dealerChapter').textContent = 'Chapter ' + dealerSelection.chapter;
      var completeBtn = document.getElementById('dealerCompleteBtn');
      if (completed[dealerSelection.key]) {
        completeBtn.textContent = 'Completed';
        completeBtn.className = 'modal-btn complete-btn done';
      } else {
        completeBtn.textContent = 'Mark Complete';
        completeBtn.className = 'modal-btn complete-btn';
      }
      document.getElementById('dealerResultModal').classList.add('show');
    }

    window.hideDealerResult = function() {
      document.getElementById('dealerResultModal').classList.remove('show');
      dealerSelection = null;
      render();
    };

    window.dealerRead = function() {
      if (!dealerSelection) return;
      openFreestyleChapter(dealerSelection.book, dealerSelection.chapter);
    };

    window.dealerComplete = function() {
      if (!dealerSelection) return;
      var key = dealerSelection.key;
      if (!completed[key]) {
        completed[key] = new Date().toISOString();
        saveData();
        var completeBtn = document.getElementById('dealerCompleteBtn');
        completeBtn.textContent = 'Completed';
        completeBtn.className = 'modal-btn complete-btn done';
      }
      // Re-render in background so stats update when modal closes
      render();
    };

    // Init
    loadData();
    if (currentPlan === null) {
      // First launch ‚Äî show plan picker
      showPlanPicker();
    } else {
      render();
      checkBackupReminder();
      if (!isFreestyleType()) {
        setTimeout(scrollToCurrent, 500);
      }
    }
  </script>
  <script>
    // Service worker registration (PWA offline support)
    if ('serviceWorker' in navigator && !isNative()) {
      navigator.serviceWorker.register('sw.js').catch(function() {});
    }
  </script>
</body>
</html>