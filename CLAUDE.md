# Bible Reading 2026 - Android & iOS PWA App

## Project Structure

```
Bible Reading App/
├── www/                         ← Web app (deployed to both Android and GitHub Pages)
│   ├── index.html               ← App source — edit this for all app changes
│   ├── manifest.json            ← PWA manifest (app name, icons, display mode)
│   ├── sw.js                    ← Service worker (offline support for PWA)
│   ├── icon-180v2.png           ← iOS home screen icon (apple-touch-icon)
│   ├── icon-192v2.png           ← PWA icon (192x192)
│   └── icon-512v2.png           ← PWA splash icon (512x512)
├── android/                     ← Capacitor-generated Android project
├── .github/workflows/
│   └── deploy.yml               ← GitHub Actions: deploys www/ to GitHub Pages on push
├── capacitor.config.json        ← Capacitor config (app ID, plugins, theme)
├── package.json                 ← npm dependencies
├── generate_icons.js            ← Node script to regenerate PWA icons (pure JS, no deps)
├── index.html                   ← Original web-only version (NOT used by builds)
└── BibleReading2026-debug.apk   ← Most recent built APK
```

## Tech Stack

- **Web app**: Single-file vanilla HTML/CSS/JS (`www/index.html`)
- **Android wrapper**: Capacitor 6 (wraps web app in native Android shell)
- **iOS/web**: PWA via GitHub Pages — installable on iPhone via Safari "Add to Home Screen"
- **Capacitor plugins**: Browser, Filesystem, Share, StatusBar, FilePicker
- **Build tools**: Gradle (via Android project), JDK 21, Android SDK 36

## Platforms

### Android
- Distributed as debug APK, updated via in-app OTA mechanism
- Capacitor wraps `www/` in a native Android WebView shell

### iOS / Web (PWA)
- Hosted on GitHub Pages: **https://lexarjeff.github.io/Bible-reading-app/**
- Installable on iPhone: Safari → Share → "Add to Home Screen"
- Runs full-screen (standalone mode), with custom icon and offline support
- Service worker caches HTML (network-first) and Google Fonts (cache-first)
- Export uses Web Share API on iOS Safari (share sheet with file), falls back to anchor download on desktop

## How to Rebuild After Making Changes

1. Edit `www/index.html` (this is the app source)
2. Sync web assets into the Android project:
   ```
   npx cap sync
   ```
3. Build the debug APK:
   ```bash
   set JAVA_HOME=C:\Program Files\Microsoft\jdk-21.0.10.7-hotspot
   set ANDROID_SDK_ROOT=C:\Users\JeffR\android-sdk
   cd android
   gradlew.bat assembleDebug
   ```
4. The APK will be at: `android\app\build\outputs\apk\debug\app-debug.apk`

### One-liner rebuild (from project root, in Git Bash):

```bash
export JAVA_HOME="/c/Program Files/Microsoft/jdk-21.0.10.7-hotspot" && export ANDROID_SDK_ROOT="$HOME/android-sdk" && npx cap sync && cd android && ./gradlew.bat assembleDebug && cd ..
```

## Deploying Updates

### Android
The user updates the app via the **in-app OTA update mechanism** only. Do NOT suggest ADB install, USB transfer, or any manual APK installation steps.

### iOS / Web (GitHub Pages)
Pushing to `main` automatically deploys `www/` to GitHub Pages via `.github/workflows/deploy.yml`. The PWA service worker uses network-first for HTML, so users get the latest version on next load.

## Version Bumping

When releasing a new version, update the version string in **two places** in `www/index.html`:
1. **Line ~15**: `var cur = "X.Y.Z";` in the OTA apply block in `<head>`
2. **Line ~318**: `const APP_VERSION = "X.Y.Z";` in the main `<script>`

Both must match. The OTA block uses `cur` to decide whether cached OTA HTML is newer. `APP_VERSION` is displayed in settings and used for update checks.

## OTA Update Mechanism

The app has a built-in OTA (over-the-air) update system:
1. **Check**: Fetches `www/index.html` from GitHub raw (`main` branch), extracts `APP_VERSION`
2. **Download**: If remote version is newer, stores the full HTML in `localStorage` keys `ota-html` and `ota-version`
3. **Apply**: On next page load, the `<head>` script compares `ota-version` to the hardcoded `cur` version. If newer, it uses `document.write()` to replace the page content with the cached HTML
4. The service worker does NOT interfere — OTA runs during HTML parsing before SW intercepts

## PWA Details

- **Manifest**: `www/manifest.json` — defines app name, icons, standalone display, portrait orientation
- **Service worker**: `www/sw.js`
  - Network-first for same-origin HTML (caches for offline fallback)
  - Cache-first for Google Fonts (CSS + WOFF2)
  - Network-only for everything else (GitHub raw for OTA, etc.)
  - `skipWaiting()` + `clients.claim()` for immediate activation
- **Icons**: Generated by `generate_icons.js` (pure Node.js, no external deps). Run `node generate_icons.js` to regenerate. Design: dark wood background (#1a1612), gold (#d4a574) open book with page lines, "2026" text below, decorative border
- **iOS cache busting**: Icon filenames include a version suffix (e.g., `icon-180v2.png`). If you regenerate icons, bump the suffix in the filenames AND update references in `www/index.html` (apple-touch-icon link) and `www/manifest.json` (icons array)
- Service worker registration is skipped on native Capacitor (`!isNative()` check)

## Key App Details

- **App ID**: `com.biblereading.app2026`
- **App Name**: Bible Reading 2026
- **Web Dir**: `www/`
- **Theme color**: `#1a1612` (dark wood)
- **Accent color**: `#d4a574` (gold)
- External links use Capacitor `Browser` plugin (in-app browser on Android)
- Export/backup: Capacitor `Filesystem` + `Share` on Android, Web Share API on iOS Safari, anchor download on desktop
- Import: `<input type="file">` (works on all platforms including iOS Safari)
- All interactive JS functions are on `window.*` (required since they're called from inline onclick handlers)

## Installed Dependencies (on this machine)

- **JDK 21**: `C:\Program Files\Microsoft\jdk-21.0.10.7-hotspot`
- **JDK 17**: `C:\Program Files\Microsoft\jdk-17.0.18.8-hotspot`
- **Android SDK**: `C:\Users\JeffR\android-sdk` (platforms 34+36, build-tools 34+36, platform-tools, cmdline-tools)
